<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Silly Cloud From TUCTF 24 | Rezy Dev</title>
<meta name="keywords" content="CTF, Kubernetes Security, TUCTF, 2025">
<meta name="description" content="The &#34;Silly Cloud&#34; challenge in TUCTF 24 involved exploiting Kubernetes security through LFI to access an internet-facing API.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c8cc592602af07182c5c77ec685d5a345edaf450c20eb609706f559cb037baef.css" integrity="sha256-yMxZJgKvBxgsXHfsaF1aNF7a9FDCDrYJcG9VnLA3uu8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }
    
        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
    </style><meta property="og:url" content="http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/">
  <meta property="og:site_name" content="Rezy Dev">
  <meta property="og:title" content="Silly Cloud From TUCTF 24">
  <meta property="og:description" content="The &#34;Silly Cloud&#34; challenge in TUCTF 24 involved exploiting Kubernetes security through LFI to access an internet-facing API.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2025-01-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-01-27T00:00:00+00:00">
    <meta property="article:tag" content="CTF">
    <meta property="article:tag" content="Kubernetes Security">
    <meta property="article:tag" content="TUCTF">
    <meta property="article:tag" content="2025">
    <meta property="og:image" content="http://localhost:1313/feature.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/feature.png">
<meta name="twitter:title" content="Silly Cloud From TUCTF 24">
<meta name="twitter:description" content="The &#34;Silly Cloud&#34; challenge in TUCTF 24 involved exploiting Kubernetes security through LFI to access an internet-facing API.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Writeups",
      "item": "http://localhost:1313/writeups/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CTF",
      "item": "http://localhost:1313/writeups/ctf/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Silly Cloud From TUCTF 24",
      "item": "http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Silly Cloud From TUCTF 24",
  "name": "Silly Cloud From TUCTF 24",
  "description": "The \"Silly Cloud\" challenge in TUCTF 24 involved exploiting Kubernetes security through LFI to access an internet-facing API.",
  "keywords": [
    "CTF", "Kubernetes Security", "TUCTF",  2025 
  ],
  "articleBody": "Hello everyone! Welcome to the writeup for a challenge called ‚ÄòSilly Cloud‚Äô from TUCTF 24. I found this challenge both fun and challenging! It revolved around interacting with the internet-facing REST API of Kubernetes (K8s).\nLooking around the web The interface of this website is shown in the screenshot below. It was essentially a cloud control manager, and I started poking around the website to look for anything interesting (if I could find something, lol). Interestingly, the dashboard for each function had a ‚ÄòDeploy‚Äô button, but all of them threw errors. BUTTT BUTTTT SIRRRR, something simple yet sneaky caught my attention! üòÇ I discovered a sweet and straightforward LFI (Local File Inclusion) in the ‚ÄòView Logs‚Äô button, which redirected to the /logs?service=registry endpoint. Using this, I could easily traverse the filesystem and read local files like /etc/passwd, /etc/hosts, and more‚Äîwell, as long as the web service had permission. üòè\nTroll begin here Since I found the LFI, my first move was to try reading the flag from common directories where it might be stored, like ../../../flag.txt and other parts of the filesystem. But nope‚Äîno luck. I mean, it shouldn‚Äôt be that easy, especially since this challenge was marked as ‚ÄòMedium,‚Äô haha.\nSo, my next plan was to read the source code of the app to figure out what was going on. But first, I had to figure out what kind of app this even was!\nI randomly visited a non-existent endpoint, /ddd, and the server responded with a ‚ÄòNot Found‚Äô page. This type of response felt pretty familiar‚Äîit‚Äôs common for Python Flask applications. Since I have decent experience working with Flask, I suspected the app might be built using it.\nSo, my next move was to read the source code of files ending with .py to dig deeper into the application. I tried accessing random non-existent directories in the filesystem, and this revealed the default directory the application was looking at: logs/*. For some reason, my brain pointed me toward the idea that the source code should be in a directory one level back. It‚Äôs probably named either main.py or app.py, as that‚Äôs common practice for naming the main file in most Flask web applications.\nI managed to retrieve the source code of the app by exploiting the LFI and accessing /logs?service=../app.py. Bingo! This gave me the full source code of the application.\nBUT BUT BUT‚Ä¶ is it actually bingo yet?! LMAO!!! Let‚Äôs find out!\nInstead of throwing the entire source code at you, let me just highlight the interesting route here:\n@app.route('/api/secrets') def get_flag(): return subprocess.check_output(['cat', 'flag.txt']) I‚Äôm sure you can guess what this does.\n‚ï≠‚îÄrezy@dev ~ ‚ï∞‚îÄ‚û§ curl https://silly-cloud.tuctf.com/api/secrets Tr0lL{this_is_a_fake_flag} Look deeper! There is a hidden flag somewhere in the cloud! You probably guessed it‚Äîit‚Äôs a troll, haha! üòÜ So, this route actually tells us a lot about the challenge. It‚Äôs not just about getting the flag directly; we need to dig deeper to find the real flag. And yep, it‚Äôs somewhere in the ‚ÄòCLOUD‚Äô.\nEnumerating More into File System At the time of writing this writeup, I already know the actual path to look at, but when I was attempting the challenge, it was a real pain in the ass to sift through all the different paths. The end result, though, was such a blessing. So, I‚Äôll just point out the interesting paths here. If you ever find yourself in a similar LFI situation, feel free to ask any LLMs for more paths to enumerate (because, honestly, that‚Äôs what I did! A lot of the interesting paths were suggested by LLMs, haha).\nI first checked /logs?service=../../../proc/mounts, which lists mounted services (or whatever they are). This pointed me to /run/secrets/kubernetes.io/serviceaccount/, and with this path, I was pretty sure the challenge was related to Kubernetes. So, I started researching Kubernetes since I‚Äôm not super familiar with Kubernetes security. I had to read up on the documentation to understand how to access it, especially since all I had was an LFI vulnerability. Most of the blogs I found about accessing Kubernetes involved kubectl, and I initially thought it was only useful if you had a shell.\nBut more research eventually led me to this particular page in the Kubernetes documentation.\nToken \u0026 Certificate The documentation also pointed out where to find the token and certificate needed to access the pods or secrets in Kubernetes.\n/var/run/secrets/kubernetes.io/serviceaccount/token contains the JWT token used to authenticate with Kubernetes when accessing it.\n/var/run/secrets/kubernetes.io/serviceaccount/ca.crt is the internal certificate authority (CA) used for secure communication.\nWith both of these pieces of information, we could easily use curl to enumerate the Kubernetes API:\ncurl --cacert /path/to/ca.crt --header \"Authorization: Bearer \" -X GET /api This would allow us to interact with the Kubernetes API server.\nCloud Part Internet Facing Server Now, the main task was to find or search for the internet-facing Kubernetes API server. While the documentation covered how to access the API directly from within the pods, our focus was on locating the internet-facing API. The documentation provided the following information, which helped me track down the API server. This led me to check the environment variables using the LFI we had. Yay!\nI checked the following file: /logs?service=../../../proc/self/environ for environment variables, and it had a ton of useful information for this challenge. (Yeah, I didn‚Äôt spot the most informative details at first‚Äîit took a few hours before I finally saw it.) Anyway, here are a few interesting ones:\nDEV_CLUSTER_ADDR=https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com SECRETS_NAMESPACE=secret-namespace The DEV_CLUSTER_ADDR pointed me to the Kubernetes cluster‚Äôs address (The Internet-Facing API), and SECRETS_NAMESPACE gave me the namespace for the secrets.\nTrouble with cURL I was using cURL the whole time with the following command:\n‚ï≠‚îÄrezy@dev ~ ‚ï∞‚îÄ‚û§ curl -k -H \"Authorization: Bearer \" https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com/api/v1/ { \"kind\": \"APIResourceList\", \"groupVersion\": \"v1\", \"resources\": [ { \"name\": \"bindings\", \"singularName\": \"binding\", \"namespaced\": true, \"kind\": \"Binding\", \"verbs\": [ \"create\" ] }, { \"name\": \"componentstatuses\", \"singularName\": \"componentstatus\", \"namespaced\": false, \"kind\": \"ComponentStatus\", \"verbs\": [ \"get\", \"list\" ], [....//snip//.....] But all I got was a ‚Äòforbidden‚Äô error when accessing secrets. Then, I discovered that kubectl can be used remotely.\nKubectl Installation We can find the installation guide for kubectl here.\nEndgame Then, using the kubectl documentation, I ran the following command to list the namespaces/files that the current user (based on the JWT token we have) can access:\nkubectl auth can-i --list \\ --server=https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com \\ --token= \\ --certificate-authority=ca.crt \\ --namespace=secret-namespace\\ This command helped me figure out what I had permission to access.\nIt will list an interesting resource called top-secret-flag. Use the following command to read the secret from top-secret-flag in the secret-namespace namespace:\nkubectl get secret top-secret-flag \\ --server=https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com \\ --token= \\ --certificate-authority=ca.crt \\ --namespace=secret-namespace \\ -o yaml This command lists information, and within it, we find our flag‚ÄîTUCTF{3ven_m04r_51lly_d3f4ul75}‚Äî(base64 encoded version though). Decoding it gives us the actual flag, and with that, the challenge is solved!\nConclusion Thanks for showing interest in my writeup! It was a fun challenge to solve. We managed to secure 40th position in this CTF, and this particular challenge was my personal favorite‚Äîit was a blast giving it a try. I learned a lot about Kubernetes, pods, and namespaces, and it was a great reminder that real learning happens outside of our comfort zones!\nThanks once again! See you in the next writeup! üòÑ\n",
  "wordCount" : "1206",
  "inLanguage": "en",
  "image":"http://localhost:1313/feature.png","datePublished": "2025-01-27T00:00:00Z",
  "dateModified": "2025-01-27T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rezy Dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="rezydev.xyz (Alt + H)">rezydev.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="üë®üèº‚Äçüíª About">
                    <span>üë®üèº‚Äçüíª About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="‚úçÔ∏è Writeups">
                    <span>‚úçÔ∏è Writeups</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="üìÇ Archives">
                    <span>üìÇ Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="üè∑Ô∏è Tags">
                    <span>üè∑Ô∏è Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="üîç Search (Alt &#43; /)" accesskey=/>
                    <span>üîç Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/writeups/">Writeups</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/writeups/ctf/">CTF</a></div>
    <h1 class="post-title entry-hint-parent">
      Silly Cloud From TUCTF 24
    </h1>
    <div class="post-description">
      The &#34;Silly Cloud&#34; challenge in TUCTF 24 involved exploiting Kubernetes security through LFI to access an internet-facing API.
    </div>
    <div class="post-meta"><span title='2025-01-27 00:00:00 +0000 UTC'>January 27, 2025</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;1206 words&nbsp;¬∑&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/Rezy-Dev/Rezy-Dev.github.io/tree/master/content/writeups/CTF/Silly%20Cloud%20From%20TUCTF%2024/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover">
            <img loading="eager" src="http://localhost:1313/writeups/ctf/silly-cloud-from-tuctf-24/feature.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#troll-begin-here">Troll begin here</a></li>
    <li><a href="#enumerating-more-into-file-system">Enumerating More into File System</a></li>
    <li><a href="#token--certificate">Token &amp; Certificate</a></li>
  </ul>

  <ul>
    <li><a href="#internet-facing-server">Internet Facing Server</a></li>
    <li><a href="#trouble-with-curl">Trouble with cURL</a></li>
    <li><a href="#kubectl-installation">Kubectl Installation</a></li>
    <li><a href="#endgame">Endgame</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>Hello everyone! Welcome to the writeup for a challenge called <em>&lsquo;Silly Cloud&rsquo;</em> from TUCTF 24. I found this challenge both fun and challenging! It revolved around interacting with the internet-facing REST API of Kubernetes (K8s).</p>
<p>
    
    <input type="checkbox" id="zoomCheck-1ba5c" hidden>
    <label for="zoomCheck-1ba5c">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127192722.png" alt="" 
             />
    </label></p>
<h1 id="looking-around-the-web">Looking around the web<a hidden class="anchor" aria-hidden="true" href="#looking-around-the-web">#</a></h1>
<p>The interface of this website is shown in the screenshot below. It was essentially a cloud control manager, and I started poking around the website to look for anything interesting (if I could find something, lol).

    
    <input type="checkbox" id="zoomCheck-5b480" hidden>
    <label for="zoomCheck-5b480">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127192744.png" alt="" 
             />
    </label></p>
<p>Interestingly, the dashboard for each function had a &lsquo;Deploy&rsquo; button, but all of them threw errors. <strong>BUTTT BUTTTT SIRRRR</strong>, something simple yet sneaky caught my attention! üòÇ I discovered a sweet and straightforward LFI (Local File Inclusion) in the &lsquo;View Logs&rsquo; button, which redirected to the <code>/logs?service=registry</code> endpoint. Using this, I could easily traverse the filesystem and read local files like <code>/etc/passwd</code>, <code>/etc/hosts</code>, and more‚Äîwell, as long as the web service had permission. üòè</p>
<h2 id="troll-begin-here">Troll begin here<a hidden class="anchor" aria-hidden="true" href="#troll-begin-here">#</a></h2>
<p>Since I found the LFI, my first move was to try reading the flag from common directories where it might be stored, like <code>../../../flag.txt</code> and other parts of the filesystem. But nope‚Äîno luck. I mean, it <em>shouldn‚Äôt</em> be that easy, especially since this challenge was marked as &lsquo;Medium,&rsquo; haha.</p>
<p>So, my next plan was to read the source code of the app to figure out what was going on. But first, I had to figure out what kind of app this even was!</p>
<p>I randomly visited a non-existent endpoint, <code>/ddd</code>, and the server responded with a &lsquo;Not Found&rsquo; page. This type of response felt pretty familiar‚Äîit‚Äôs common for Python Flask applications. Since I have decent experience working with Flask, I suspected the app might be built using it.</p>
<p>So, my next move was to read the source code of files ending with <code>.py</code> to dig deeper into the application.

    
    <input type="checkbox" id="zoomCheck-c61ea" hidden>
    <label for="zoomCheck-c61ea">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127193628.png" alt="" 
             />
    </label></p>
<p>I tried accessing random non-existent directories in the filesystem, and this revealed the default directory the application was looking at: <code>logs/*</code>.

    
    <input type="checkbox" id="zoomCheck-f15be" hidden>
    <label for="zoomCheck-f15be">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127194000.png" alt="" 
             />
    </label></p>
<p>For some reason, my brain pointed me toward the idea that the source code should be in a directory one level back. It‚Äôs probably named either <code>main.py</code> or <code>app.py</code>, as that‚Äôs common practice for naming the main file in most Flask web applications.</p>
<p>I managed to retrieve the source code of the app by exploiting the LFI and accessing <code>/logs?service=../app.py</code>. Bingo! This gave me the full source code of the application.</p>
<p>BUT BUT BUT&hellip; is it actually <em>bingo</em> yet?! LMAO!!! Let‚Äôs find out!</p>
<p>Instead of throwing the entire source code at you, let me just highlight the interesting route here:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/api/secrets&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_flag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;flag.txt&#39;</span><span class="p">])</span>
</span></span></code></pre></div><p>I‚Äôm sure you can guess what this does.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ï≠‚îÄrezy@dev ~  
</span></span><span class="line"><span class="cl">‚ï∞‚îÄ‚û§  curl https://silly-cloud.tuctf.com/api/secrets               
</span></span><span class="line"><span class="cl">Tr0lL<span class="o">{</span>this_is_a_fake_flag<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Look deeper! There is a hidden flag somewhere in the cloud!
</span></span></code></pre></div><p>You probably guessed it‚Äîit&rsquo;s a troll, haha! üòÜ So, this route actually tells us a lot about the challenge. It‚Äôs not just about getting the flag directly; we need to dig deeper to find the real flag. And yep, it&rsquo;s somewhere in the &lsquo;CLOUD&rsquo;.</p>
<h2 id="enumerating-more-into-file-system">Enumerating More into File System<a hidden class="anchor" aria-hidden="true" href="#enumerating-more-into-file-system">#</a></h2>
<p>At the time of writing this writeup, I already know the actual path to look at, but when I was attempting the challenge, it was a real pain in the ass to sift through all the different paths. The end result, though, was such a blessing. So, I‚Äôll just point out the interesting paths here. If you ever find yourself in a similar LFI situation, feel free to ask any LLMs for more paths to enumerate (because, honestly, that‚Äôs what I did! A lot of the interesting paths were suggested by LLMs, haha).</p>
<p>I first checked <code>/logs?service=../../../proc/mounts</code>, which lists mounted services (or whatever they are). This pointed me to <code>/run/secrets/kubernetes.io/serviceaccount/</code>, and with this path, I was pretty sure the challenge was related to Kubernetes. So, I started researching Kubernetes since I‚Äôm not super familiar with Kubernetes security. I had to read up on the documentation to understand how to access it, especially since all I had was an LFI vulnerability. Most of the blogs I found about accessing Kubernetes involved <code>kubectl</code>, and I initially thought it was only useful if you had a shell.</p>
<p>But more research eventually led me to <a href="https://kubernetes.io/docs/tasks/run-application/access-api-from-pod/#directly-accessing-the-rest-api"><em>this</em></a> particular page in the Kubernetes documentation.</p>
<h2 id="token--certificate">Token &amp; Certificate<a hidden class="anchor" aria-hidden="true" href="#token--certificate">#</a></h2>
<p>The documentation also pointed out where to find the token and certificate needed to access the pods or secrets in Kubernetes.</p>
<p><code>/var/run/secrets/kubernetes.io/serviceaccount/token</code> contains the JWT token used to authenticate with Kubernetes when accessing it.<br>
<code>/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</code> is the internal certificate authority (CA) used for secure communication.</p>
<p>With both of these pieces of information, we could easily use <code>curl</code> to enumerate the Kubernetes API:</p>
<pre tabindex="0"><code>curl --cacert /path/to/ca.crt --header &#34;Authorization: Bearer &lt;JWT-TOKEN&gt;&#34; -X GET &lt;API-SERVER&gt;/api
</code></pre><p>This would allow us to interact with the Kubernetes API server.</p>
<h1 id="cloud-part">Cloud Part<a hidden class="anchor" aria-hidden="true" href="#cloud-part">#</a></h1>
<h2 id="internet-facing-server">Internet Facing Server<a hidden class="anchor" aria-hidden="true" href="#internet-facing-server">#</a></h2>
<p>Now, the main task was to find or search for the internet-facing Kubernetes API server. While the documentation covered how to access the API directly from within the pods, our focus was on locating the internet-facing API. The documentation provided the following information, which helped me track down the API server.

    
    <input type="checkbox" id="zoomCheck-ee11f" hidden>
    <label for="zoomCheck-ee11f">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127200618.png" alt="" 
             />
    </label></p>
<p>This led me to check the environment variables using the LFI we had. Yay!</p>
<p>I checked the following file: <code>/logs?service=../../../proc/self/environ</code> for environment variables, and it had a ton of useful information for this challenge. (Yeah, I didn‚Äôt spot the most informative details at first‚Äîit took a few hours before I finally saw it.) Anyway, here are a few interesting ones:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">DEV_CLUSTER_ADDR</span><span class="o">=</span>https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com
</span></span><span class="line"><span class="cl"><span class="nv">SECRETS_NAMESPACE</span><span class="o">=</span>secret-namespace
</span></span></code></pre></div><p>The <code>DEV_CLUSTER_ADDR</code> pointed me to the Kubernetes cluster&rsquo;s address (The Internet-Facing API), and <code>SECRETS_NAMESPACE</code> gave me the namespace for the secrets.</p>
<h2 id="trouble-with-curl">Trouble with cURL<a hidden class="anchor" aria-hidden="true" href="#trouble-with-curl">#</a></h2>
<p>I was using <code>cURL</code> the whole time with the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">‚ï≠‚îÄrezy@dev ~  
</span></span><span class="line"><span class="cl">‚ï∞‚îÄ‚û§  curl -k -H <span class="s2">&#34;Authorization: Bearer &lt;TOKEN&gt;&#34;</span> https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com/api/v1/                          
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;kind&#34;</span>: <span class="s2">&#34;APIResourceList&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;groupVersion&#34;</span>: <span class="s2">&#34;v1&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;resources&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;bindings&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;singularName&#34;</span>: <span class="s2">&#34;binding&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;namespaced&#34;</span>: true,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;kind&#34;</span>: <span class="s2">&#34;Binding&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;verbs&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;create&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;componentstatuses&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;singularName&#34;</span>: <span class="s2">&#34;componentstatus&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;namespaced&#34;</span>: false,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;kind&#34;</span>: <span class="s2">&#34;ComponentStatus&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;verbs&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;get&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;list&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>....//snip//.....<span class="o">]</span>
</span></span></code></pre></div><p>But all I got was a &lsquo;forbidden&rsquo; error when accessing secrets. Then, I discovered that <code>kubectl</code> can be used remotely.</p>
<h2 id="kubectl-installation">Kubectl Installation<a hidden class="anchor" aria-hidden="true" href="#kubectl-installation">#</a></h2>
<p>We can find the installation guide for <code>kubectl</code> <a href="https://kubernetes.io/docs/tasks/tools/">here</a>.</p>
<h2 id="endgame">Endgame<a hidden class="anchor" aria-hidden="true" href="#endgame">#</a></h2>
<p>Then, using the <code>kubectl</code> documentation, I ran the following command to list the namespaces/files that the current user (based on the JWT token we have) can access:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl auth can-i --list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --server<span class="o">=</span>https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --token<span class="o">=</span>&lt;TOKEN&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-authority<span class="o">=</span>ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --namespace<span class="o">=</span>secret-namespace<span class="se">\
</span></span></span></code></pre></div><p>This command helped me figure out what I had permission to access.</p>
<p>It will list an interesting resource called <code>top-secret-flag</code>. Use the following command to read the secret from <code>top-secret-flag</code> in the <code>secret-namespace</code> namespace:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get secret top-secret-flag <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --server<span class="o">=</span>https://7b9fc16d-5421-47b3-ab64-83dfee3050eb.k8s.ondigitalocean.com <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --token<span class="o">=</span>&lt;JWT-TOKEN&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --certificate-authority<span class="o">=</span>ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --namespace<span class="o">=</span>secret-namespace <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -o yaml
</span></span></code></pre></div><p>
    
    <input type="checkbox" id="zoomCheck-138cc" hidden>
    <label for="zoomCheck-138cc">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127203937.png" alt="" 
             />
    </label></p>
<p>This command lists information, and within it, we find our flag‚Äî<code>TUCTF{3ven_m04r_51lly_d3f4ul75}</code>‚Äî(base64 encoded version though). Decoding it gives us the actual flag, and with that, the challenge is solved!</p>
<h1 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h1>
<p>Thanks for showing interest in my writeup! It was a fun challenge to solve. We managed to secure 40th position in this CTF, and this particular challenge was my personal favorite‚Äîit was a blast giving it a try.

    
    <input type="checkbox" id="zoomCheck-305f7" hidden>
    <label for="zoomCheck-305f7">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="assets/Pasted%20image%2020250127204350.png" alt="" 
             />
    </label></p>
<p>I learned a lot about Kubernetes, pods, and namespaces, and it was a great reminder that real learning happens outside of our comfort zones!</p>
<p>Thanks once again! See you in the next writeup! üòÑ</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/ctf/">CTF</a></li>
      <li><a href="http://localhost:1313/tags/kubernetes-security/">Kubernetes Security</a></li>
      <li><a href="http://localhost:1313/tags/tuctf/">TUCTF</a></li>
      <li><a href="http://localhost:1313/tags/2025/">2025</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/writeups/ctf/learn-how-eval-function-is-evil-for-discord-bots/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Why You Shouldn&#39;t Use eval() in Discord Bots (or in Any App)</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Rezy Dev</a></span> ¬∑ 

    <span>
        <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="noopener noreferrer" target="_blank">Some rights reserved</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
